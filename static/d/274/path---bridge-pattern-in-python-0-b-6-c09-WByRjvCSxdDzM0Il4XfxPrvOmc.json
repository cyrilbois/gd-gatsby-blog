{"data":{"site":{"siteMetadata":{"title":"Giacomo Debidda","author":"Giacomo Debidda","description":"Giacomo Debidda's Personal Blog"}},"markdownRemark":{"id":"0fe839c2-da0a-5cfd-9bdd-b2097f7b5f34","excerpt":"I struggled quite a bit with the Bridge pattern. The idea itself is rather simple, decouple an interface from its implementation, but I…","timeToRead":5,"html":"<p>I struggled quite a bit with the Bridge pattern. The idea itself is rather simple, decouple an interface from its implementation, but I couldn’t think about a simple, yet “real life” example of this pattern.</p>\n<h2>A Bridge between two class hierarchies</h2>\n<p>The purpose of the Bridge pattern is to split a concept into two independent class hierarchies. These two class hierarchies are usually called <em>Interface</em> (or <em>Handle</em>, or <em>Abstraction</em>) and <em>Implementation</em> (or <em>Body</em>).</p>\n<p>A <a href=\"https://en.wikipedia.org/wiki/Bridge_pattern#Java\">classic example</a> of Bridge is used in the definition of shapes in an UI environment: one class hierarchy is responsible to define shapes, the other one to draw them on the screen.</p>\n<p>Bridge achieves the <a href=\"https://en.wikipedia.org/wiki/Separation_of_concerns\">separation of concerns</a> between orthogonal class hierarchies via <em>composition</em>: the interface object encapsulates an instance of an Implementation class. The Interface class is used directly by the client, but the actual work is done in the Implementation class. The client interacts with the interface object, and doesn’t have to deal with the details of the different implementations. It’s the interface object that delegates all requests to the implementation object it encapsulates.</p>\n<blockquote>\n<p>Decouple an abstraction from its implementation so that the two can vary independently.</p>\n</blockquote>\n<h2>A simple, yet real world use-case</h2>\n<p>As I said at the beginning, it wasn’t easy for me to find a simple real-life scenario where I would use this pattern. I didn’t want to reuse the shape-draw example, and the first attempts I made where either too trivial or they were missing the point.</p>\n<p>Then I though about A/B testing.</p>\n<p>Let’s say that you want to build a news website and you want to show different content for different users. You want to give paid users full access to articles, without any ads. At the same time, you want to give free users some excerpts from the articles, with some ads on the page. Finally, you want to show a <a href=\"https://en.wikipedia.org/wiki/Call_to_action_(marketing)\"><em>call to action</em></a> to all free users, so you can hopefully convert them to paid users.</p>\n<p>You know what to draw in the UI, and where to draw it, but you still can’t decide on what to put in the call to action. Here is where A/B testing comes in: you can create two different implementations of the UI components, and by changing only the call to action you can decide which one is more effective.\nIn a real life scenario the call to action could be a web component of some sort, maybe an element with a slightly different style, color, font size, etc. In this example it’s just a different sentence for the two implementations.</p>\n<p>It might be useful to summarize what the components in this toy example represent:</p>\n<div class=\"table-responsive\">\n    <table class=\"table table-hover\">\n        <thead class=\"thead-inverse\">\n            <tr>\n                <th>Client</th>\n                <th>Interface</th>\n                <th>Implementation</th>\n            </tr>\n        </thead>\n        <tbody>\n            <tr>\n                <td>the user</td>\n                <td>the UI of the website</td>\n                <td>what it's drawn in each UI component</td>\n            </tr>\n        </tbody>\n    </table>\n</div>\n<p>The Interface is the UI of website. There are free users and paid users, so there are two interfaces to build: one with ads, excerpts and a call to action (free version) and another one with full articles (paid version).</p>\n<p>Ok, let’s see some code!</p>\n<p>First, let’s define an abstract class for the website. This is the <em>abstraction of the Interface</em> (or <em>abstraction of the Abstraction</em>).</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> abc <span class=\"token keyword\">import</span> ABC<span class=\"token punctuation\">,</span> abstractmethod\n\n\n<span class=\"token comment\"># Abstract Interface (aka Handle) used by the client</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Website</span><span class=\"token punctuation\">(</span>ABC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> implementation<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># encapsulate an instance of a concrete implementation class</span>\n        self<span class=\"token punctuation\">.</span>_implementation <span class=\"token operator\">=</span> implementation\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__str__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'Interface: {}; Implementation: {}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>\n            self<span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__name__<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>_implementation<span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__name__<span class=\"token punctuation\">)</span>\n\n    @abstractmethod\n    <span class=\"token keyword\">def</span> <span class=\"token function\">show_page</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">pass</span></code></pre></div>\n<p>Here is the free version of the website. It’s a concrete Interface (or <em>refined Abstraction</em>).</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Concrete Interface 1</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FreeWebsite</span><span class=\"token punctuation\">(</span>Website<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">show_page</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        ads <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>_implementation<span class=\"token punctuation\">.</span>get_ads<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        text <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>_implementation<span class=\"token punctuation\">.</span>get_excerpt<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        call_to_action <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>_implementation<span class=\"token punctuation\">.</span>get_call_to_action<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>ads<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>call_to_action<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>And here is the paid version of the website.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Concrete Interface 2</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PaidWebsite</span><span class=\"token punctuation\">(</span>Website<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">show_page</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        text <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>_implementation<span class=\"token punctuation\">.</span>get_article<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now it’s useful to have a look at the Client code. Each interface object requires an instance of an Implementation class, but apart from that, the client code interacts only with the interface, not with the implementation.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Client</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    a_free <span class=\"token operator\">=</span> FreeWebsite<span class=\"token punctuation\">(</span>ImplementationA<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>a_free<span class=\"token punctuation\">)</span>\n    a_free<span class=\"token punctuation\">.</span>show_page<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># the client interacts only with the interface</span>\n\n    b_free <span class=\"token operator\">=</span> FreeWebsite<span class=\"token punctuation\">(</span>ImplementationB<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>b_free<span class=\"token punctuation\">)</span>\n    b_free<span class=\"token punctuation\">.</span>show_page<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    a_paid <span class=\"token operator\">=</span> PaidWebsite<span class=\"token punctuation\">(</span>ImplementationA<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>a_paid<span class=\"token punctuation\">)</span>\n    a_paid<span class=\"token punctuation\">.</span>show_page<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    b_paid <span class=\"token operator\">=</span> PaidWebsite<span class=\"token punctuation\">(</span>ImplementationB<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>b_paid<span class=\"token punctuation\">)</span>\n    b_paid<span class=\"token punctuation\">.</span>show_page<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Finally, here is the Implementation class hierarchy. First, the abstract class.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Abstract Implementation (aka Body) decoupled from the client</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Implementation</span><span class=\"token punctuation\">(</span>ABC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_excerpt</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'excerpt from the article'</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_article</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'full article'</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_ads</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'some ads'</span>\n\n    @abstractmethod\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_call_to_action</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">pass</span></code></pre></div>\n<p>Second, the concrete implementations.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Concrete Implementation 1</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ImplementationA</span><span class=\"token punctuation\">(</span>Implementation<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_call_to_action</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'Pay 10 $ a month to remove ads'</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Concrete Implementation 2</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ImplementationB</span><span class=\"token punctuation\">(</span>Implementation<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_call_to_action</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'Remove ads with just 10 $ a month'</span></code></pre></div>\n<p>Here is the output of the client code (main function) in this example:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> Interface<span class=\"token punctuation\">:</span> FreeWebsite<span class=\"token punctuation\">;</span> Implementation<span class=\"token punctuation\">:</span> ImplementationA\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> some ads\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> excerpt <span class=\"token keyword\">from</span> the article\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> Pay <span class=\"token number\">10</span> $ a month to remove ads  <span class=\"token comment\"># &lt;-- call to action A</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> Interface<span class=\"token punctuation\">:</span> FreeWebsite<span class=\"token punctuation\">;</span> Implementation<span class=\"token punctuation\">:</span> ImplementationB\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> some ads\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> excerpt <span class=\"token keyword\">from</span> the article\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> Remove ads <span class=\"token keyword\">with</span> just <span class=\"token number\">10</span> $ a month  <span class=\"token comment\"># &lt;-- call to action B</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> Interface<span class=\"token punctuation\">:</span> PaidWebsite<span class=\"token punctuation\">;</span> Implementation<span class=\"token punctuation\">:</span> ImplementationA\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> full article</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> Interface<span class=\"token punctuation\">:</span> PaidWebsite<span class=\"token punctuation\">;</span> Implementation<span class=\"token punctuation\">:</span> ImplementationB\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> full article</code></pre></div>\n<p>There is no call to action in the paid version, so there is no difference between ImplementationA and ImplementationB. This is a toy example after all. In the real world <code class=\"language-text\">ImplementationA</code> could return a random article, while <code class=\"language-text\">ImplementationB</code> could track the user preferences and guess an article he/she might be interested in. Also, in a real world scenario you could perform A/B testing of a website by choosing a random implementation instead of declaring it explicitly. Something along these lines:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> random\nrandom_implementation <span class=\"token operator\">=</span> random<span class=\"token punctuation\">.</span>choice<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>ImplementationA<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ImplementationB<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>References</h2>\n<p>These articles really helped me to understand the Bridge pattern:</p>\n<ul>\n<li><a href=\"https://sourcemaking.com/design_patterns/bridge\">Bridge</a></li>\n<li><a href=\"https://simpleprogrammer.com/2015/06/08/design-patterns-simplified-the-bridge-pattern/\">Design Patterns Simplified: The Bridge Pattern</a></li>\n</ul>","frontmatter":{"title":"Bridge pattern in Python","date":"January 21, 2017"}}},"pageContext":{"slug":"/bridge-pattern-in-python/","previous":{"fields":{"slug":"/visualize-gml-files-with-d3/"},"timeToRead":4,"frontmatter":{"title":"Visualize GML files with D3","path":"/visualize-gml-files-with-d3/"}},"next":{"fields":{"slug":"/template-method-pattern-in-python/"},"timeToRead":5,"frontmatter":{"title":"Template Method pattern in Python","path":"/template-method-pattern-in-python/"}}}}