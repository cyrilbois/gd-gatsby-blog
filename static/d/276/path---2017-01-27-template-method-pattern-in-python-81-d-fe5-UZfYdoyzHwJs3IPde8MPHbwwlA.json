{"data":{"site":{"siteMetadata":{"title":"Giacomo Debidda","author":"Giacomo Debidda"}},"markdownRemark":{"id":"d1c7adf3-50ef-5158-9e97-0aac4680b323","excerpt":"Behavioral design patterns are a family of patterns which focus on algorithms and the assignments of responsibilities between objects. They…","html":"<p>Behavioral design patterns are a family of patterns which focus on algorithms and the assignments of responsibilities between objects. They help in changing the behavior of the objects and reduce the coupling between them. In this article we will see a Python implementation of the <em>Template Method</em> pattern. Next time we will see the <a href=\"http://www.giacomodebidda.com/blog/strategy-pattern-in-python/\"><em>Strategy</em> pattern</a>.</p>\n<p>Template Method defines an algorithm’s skeleton in a base class, and lets subclasses redefine certain steps of the algorithm. The skeleton stays the same for all subclasses, and it defines which methods to call and when to call them. Some methods in the base class are just <em>placeholders</em> (or <em>hooks</em>), and they have to be overridden in each subclass.</p>\n<p>A typical implementation of this pattern consists in an abstract class for the base class, and one or more concrete subclasses. The abstract class has the following methods:</p>\n<ol>\n<li>one <em>template method</em> that calls one or more methods. Subclasses should not override this particular method, which defines the skeleton of the algorithm. This method gives the name to this pattern, so in this Python implementation I called it <code class=\"language-text\">template_method</code>.</li>\n<li>one or more abstract methods, which represent the customizable part of the algorithm. The abstract base class defines these methods, but they are just placeholders and have to be overriden by each subclass. Sometimes they are named “primitive operations”, “hooks” or “placeholders”. I called these methods <code class=\"language-text\">do_step_1</code> and <code class=\"language-text\">do_step_2</code>.</li>\n<li>zero or more methods which are common in each subclass. These methods are implemented in the base class and should not be overridden in any subclass. In Java we could make these methods <code class=\"language-text\">final</code>. In Python we can place two underscore before the method name and “protect” them from being overridden by using <a href=\"https://docs.python.org/2/reference/expressions.html#atom-identifiers\">private name mangling</a>. The method can still be overriden by a subclass, but with no effect, because the name mangling replaces the original method name with the class name where the method is originally defined, plus the original method name itself. In the code below, <code class=\"language-text\">__do_absolutely_this</code> is one of such methods.</li>\n<li>one or more methods that have a default implementation in the base class, but that can be overridden by some sublasses. Here is the <code class=\"language-text\">do_something</code> method.</li>\n</ol>\n<p>Private name mangling for the <code class=\"language-text\">__do_absolutely_this</code> method. The original class name is prepended to the method name. That’s why we see <code class=\"language-text\">Algorithm__do_absolutely_this</code> even when we look at the list of attributes of class <code class=\"language-text\">AlgorithmA</code>.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/private_name_mangling-15a1165223784550a206eefcd5eb5f6c-b42e9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 62.47113163972286%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABrUlEQVQoz42S3W7aQBCF/f4vUKlSXqBqc9ebXoFAVYFIETVImJraxL9r718wMVDAp+M1poQ2SUf6tLvj3eOzs2PN5h6cxQNcP0TEJEImDO08IuJMGsJUXMCxWEb44YWnMcBsvoAVBAGyKILmOdIohGQMeRIji2OkcYQ8z8Drb5QTgkMraUZBOSVFs6Z5UazAWAqrLDfQQkKlKaL7eyS2DTadQjsODqsV6qiqqgFNVCfaqE4LpTSsYr2GEsIQkVPOObbb7VnkOi5z5x+dclqT4PrpCYqTIAmxLMP+cDi7uD70Go1D9UdQ5jnVRuB4PD4Tunb1r2i/F0XRCnLI2iE9SFmWfwm+Fe2+ulTWmmqopTI1TJLE2P7fa15febPZNA5Xj49GMCeX7ZUv41g1L9mMLwsah5rEeJaDkbv6hXe73TP2+1+0teXw6tWNYEwNfIZEU+rHmiRJkVGj/lzGuO36+Px1iU/dB9hOgIU7x2zmwHVdc87zPPi+b9rOGo/HmEwmsKmhL/lOTCc2hndjvP84wM3tAO8+DPCl8w39XhedTge9Xg/D4RD9ft8wGo3wGzy8kkBaj+kLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Private name mangling\"\n        title=\"Private name mangling\"\n        src=\"/static/private_name_mangling-15a1165223784550a206eefcd5eb5f6c-fb8a0.png\"\n        srcset=\"/static/private_name_mangling-15a1165223784550a206eefcd5eb5f6c-1a291.png 148w,\n/static/private_name_mangling-15a1165223784550a206eefcd5eb5f6c-2bc4a.png 295w,\n/static/private_name_mangling-15a1165223784550a206eefcd5eb5f6c-fb8a0.png 590w,\n/static/private_name_mangling-15a1165223784550a206eefcd5eb5f6c-b42e9.png 866w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2>The Skeleton</h2>\n<p>Here is the abstract base class which defines the <code class=\"language-text\">template_method</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> sys\n<span class=\"token keyword\">from</span> abc <span class=\"token keyword\">import</span> ABC<span class=\"token punctuation\">,</span> abstractmethod\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Algorithm</span><span class=\"token punctuation\">(</span>ABC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">template_method</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"Skeleton of operations to perform. DON'T override me.\n\n        The Template Method defines a skeleton of an algorithm in an operation,\n        and defers some steps to subclasses.\n        \"\"\"</span>\n        self<span class=\"token punctuation\">.</span>__do_absolutely_this<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>do_step_1<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>do_step_2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>do_something<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__do_absolutely_this</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"Protected operation. DON'T override me.\"\"\"</span>\n        this_method_name <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>_getframe<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>f_code<span class=\"token punctuation\">.</span>co_name\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'{}.{}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__name__<span class=\"token punctuation\">,</span> this_method_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    @abstractmethod\n    <span class=\"token keyword\">def</span> <span class=\"token function\">do_step_1</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"Primitive operation. You HAVE TO override me, I'm a placeholder.\"\"\"</span>\n        <span class=\"token keyword\">pass</span>\n\n    @abstractmethod\n    <span class=\"token keyword\">def</span> <span class=\"token function\">do_step_2</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"Primitive operation. You HAVE TO override me, I'm a placeholder.\"\"\"</span>\n        <span class=\"token keyword\">pass</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">do_something</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"Hook. You CAN override me, I'm NOT a placeholder.\"\"\"</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'do something'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>A quick note about the <code class=\"language-text\">ABC</code> module.</h2>\n<p>Sometimes in Python you create “abstract” methods this way:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">some_method_in_base_class</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">raise</span> NotImplementedError<span class=\"token punctuation\">(</span><span class=\"token string\">'Implement me in subclass'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>However, you can still create instances of a subclass if you don’t override such method. You will simply get a <code class=\"language-text\">NotImplementedError</code> exception when you try to call that method on an instance of the subclass.</p>\n<p>I like to use <code class=\"language-text\">ABC</code> because <strong>you cannot even instantiate</strong> a subclass of <code class=\"language-text\">Algorithm</code> if you don’t override all abstract methods.</p>\n<h2>The Customizable Parts</h2>\n<p>Each concrete subclass <strong>have to</strong> override <code class=\"language-text\">do_step_1</code> and <code class=\"language-text\">do_step_2</code>, because they are decorated with the <code class=\"language-text\">@abstractmethod</code> decorator from the <code class=\"language-text\">ABC</code> module. Each sublclass <strong>can</strong> override <code class=\"language-text\">do_something</code>, or it will use the default implementation provided by the base class.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">AlgorithmA</span><span class=\"token punctuation\">(</span>Algorithm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">do_step_1</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'do step 1 for Algorithm A'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">do_step_2</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'do step 2 for Algorithm A'</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">AlgorithmB</span><span class=\"token punctuation\">(</span>Algorithm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">do_step_1</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'do step 1 for Algorithm B'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">do_step_2</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'do step 2 for Algorithm B'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">do_something</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'do something else'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>The Hollywood Principle</h2>\n<p>Here comes the interesting part…</p>\n<p>Most of the time a subclass calls the methods of its parent, so the flow of control goes from the subclass to its parent. However, in <code class=\"language-text\">template_method</code> the flow goes from the base class to a subclass, a principle called <em>Inversion of Control (IoC)</em>.</p>\n<p>IoC, also called Hollywood Principle - <em>Don’t call us, we’ll call you</em> - decouples the execution of a task from its implementation. The client code doesn’t call directly the methods responsible for the implementation (<code class=\"language-text\">do_step_1</code> and <code class=\"language-text\">do_step_2</code>), but calls a method provided by the base class (<code class=\"language-text\">template_method</code>), which calls the implementation methods itself.</p>\n<blockquote>\n<p>Capture the abstraction in an interface, and bury the implementation details in its subclasses.</p>\n</blockquote>\n<p>This situation is quite common in frameworks. Each framework designs a common interface that implements the invariant pieces of a system’s architecture, and defines placeholders for all customizable parts. Most of the time it’s the framework itself that calls the methods supplied by the user.</p>\n<h2>The client code</h2>\n<p>Finally, here is the client code…</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Algorithm A'</span><span class=\"token punctuation\">)</span>\n    a <span class=\"token operator\">=</span> AlgorithmA<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    a<span class=\"token punctuation\">.</span>template_method<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\nAlgorithm B'</span><span class=\"token punctuation\">)</span>\n    b <span class=\"token operator\">=</span> AlgorithmB<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    b<span class=\"token punctuation\">.</span>template_method<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>and the output:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> Algorithm A\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> AlgorithmA<span class=\"token punctuation\">.</span>__do_absolutely_this\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> do step <span class=\"token number\">1</span> <span class=\"token keyword\">for</span> Algorithm A\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> do step <span class=\"token number\">2</span> <span class=\"token keyword\">for</span> Algorithm A\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> do something\n\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> Algorithm B\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> AlgorithmB<span class=\"token punctuation\">.</span>__do_absolutely_this\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> do step <span class=\"token number\">1</span> <span class=\"token keyword\">for</span> Algorithm B\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> step <span class=\"token number\">2</span> <span class=\"token keyword\">for</span> Algorithm B\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> something <span class=\"token keyword\">else</span></code></pre></div>\n<p>You need the code? Grab it <a href=\"https://github.com/jackaljack/design-patterns\">here</a>!</p>\n<h2>References</h2>\n<p>Here are some additional resources you might find useful:</p>\n<ul>\n<li><a href=\"https://sourcemaking.com/design_patterns/template_method\">Template Method on Sourcemaking.com</a></li>\n<li><a href=\"https://martinfowler.com/bliki/InversionOfControl.html\">Martin Fowler’s article on Inversion of Control</a></li>\n</ul>","frontmatter":{"title":"Template Method pattern in Python","date":"January 27, 2017"}}},"pageContext":{"slug":"/2017-01-27-template-method-pattern-in-python/","previous":{"fields":{"slug":"/2017-01-21-bridge-pattern-in-python/"},"frontmatter":{"title":"Bridge pattern in Python"}},"next":{"fields":{"slug":"/2017-01-28-strategy-pattern-in-python/"},"frontmatter":{"title":"Strategy pattern in Python"}}}}