{"data":{"site":{"siteMetadata":{"title":"Giacomo Debidda","author":"Giacomo Debidda"}},"markdownRemark":{"id":"60e35fae-9f70-5d8a-af09-7d782dbeb3e9","excerpt":"I have been wanting to play around with the  regl  library since I wathed the  talk that Mikola Lysenko gave at PLOTCON 2016 , and this week…","html":"<p>I have been wanting to play around with the <a href=\"https://github.com/regl-project/regl\">regl</a> library since I wathed the <a href=\"https://www.youtube.com/watch?v=rFjszW5L2aw&#x26;t=1196s\">talk that Mikola Lysenko gave at PLOTCON 2016</a>, and this week I finally decided to invest some time in setting up a repo with Webpack and some regl examples.</p>\n<p>regl is a pretty new library, but it seems quite popular among data visualization practitioners. <a href=\"http://vallandingham.me/regl_intro.html\">Jim Vallandingham</a> and <a href=\"https://peterbeshai.com/beautifully-animate-points-with-webgl-and-regl.html\">Peter Beshai</a> wrote really nice tutorials about regl, and Nadieh Bremer created the stunning visualization <a href=\"https://bl.ocks.org/nbremer/1acc6c95e3bb374dc78329e94f85a9b0\">“A breathing Earth”</a>.</p>\n<h2>regl and WebGL</h2>\n<p>Before starting to learn about regl, you need some basic knowledge about WebGL, the low level API to draw 3D graphics in the browser, and its <a href=\"http://tsherif.github.io/webgl-presentation/#/\">graphics pipeline (aka rendering pipeline)</a>. <a href=\"https://webglfundamentals.org/webgl/lessons/webgl-how-it-works.html\">This article on WebGL Fundamentals</a> does a great job in explaining what WebGL is:</p>\n<blockquote>\n<p>WebGL is just a rasterization engine. It draws points, lines, and triangles based on code you supply.</p>\n</blockquote>\n<p>WebGL runs on the GPU on your computer, and you need to provide the code in the form of two functions: a <strong>vertex shader</strong> and a <strong>fragment shader</strong>.</p>\n<p>Another important thing to know is that WebGL is a <a href=\"https://www.packtpub.com/mapt/book/game_development/9781849699792/3/ch03lvl1sec24/understanding-webgl--a-state-machine\">state machine</a>: once you modify an attributes, that modification is permanent until you modify that attribute again.</p>\n<p>regl is <strong>functional abstration</strong> of WebGL. It simplifies WebGL programming by removing as much shared state as it can get away with.</p>\n<p>In regl there are two fundamentals abstractions: <strong>resources</strong> and <strong>commands</strong>.</p>\n<ul>\n<li>A resource is a handle to something that you load on the GPU, like a texture.</li>\n<li>A command is a complete representation of the WebGL state required to perform some draw call. It wraps it up and packages it into a single reusable function.</li>\n</ul>\n<p>In this article I will only talk about <a href=\"http://regl.party/api#commands\">commands</a>.</p>\n<h2>Project structure and boilerplate</h2>\n<p>I found out that if I want to learn a new technology/library/tool I have to play around with it, so I created a repo and I called it <a href=\"https://github.com/jackdbd/regl-playground\">regl-playground</a>.</p>\n<p>Let’s start defining the structure for this repo. Here is the root directory:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">.\n├── package.json\n├── README.md\n├── src\n└── webpack.config.js</code></pre></div>\n<p>And here is the <code class=\"language-text\">src</code> directory.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">.\n├── css\n│   └── main.css\n├── js\n│   ├── index.js\n│   └── one-shot-rendering.js\n└── templates\n    ├── index.html\n    └── one-shot-rendering.html</code></pre></div>\n<p>You will need <code class=\"language-text\">regl</code> and a few dev dependencies for webpack. If you want to save some time (and keystrokes), you can copy the <code class=\"language-text\">package.json</code> down below and install all you need with <code class=\"language-text\">yarn install</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"regl-playground\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"repository\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"git@github.com:jackdbd/regl-playground.git\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jackdbd &lt;jackdebidda@gmail.com>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"license\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MIT\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"webpack-dev-server --config webpack.config.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint src\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"webpack --config webpack.config.js --progress\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"babel-core\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^6.26.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"babel-loader\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.1.2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"babel-preset-es2015\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^6.24.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"clean-webpack-plugin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^0.1.17\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"eslint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.5.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"eslint-config-airbnb-base\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^12.1.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"eslint-plugin-import\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.7.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"extract-text-webpack-plugin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.0.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"html-webpack-plugin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.30.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"style-loader\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^0.19.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"webpack\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.8.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"webpack-bundle-analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.9.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"webpack-dev-server\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.9.3\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"regl\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^1.3.0\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Next, you will need 2 HTML files, one for the index, one for the actual regl application. I think it’s a good idea to put these files in <code class=\"language-text\">src/templates</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- index.html --></span>\n<span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>x-ua-compatible<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>ie=edge<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Home<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>description<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Home of regl-playground<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- bundle.css is injected here by html-webpack-plugin --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>header</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>List of regl examples<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>header</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/one-shot-rendering.html<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>one-shot rendering<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>For documentation, see the <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://regl.party/<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>_blank<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>regl API<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>footer</span><span class=\"token punctuation\">></span></span>Examples with regl version <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>code</span><span class=\"token punctuation\">></span></span>1.3.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>code</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>footer</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- bundle.js is injected here by html-webpack-plugin --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- one-shot-rendering.html --></span>\n<span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>x-ua-compatible<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>ie=edge<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>One shot rendering<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>description<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>regl example with one shot rendering<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- bundle.css is injected here by html-webpack-plugin --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/index.html<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Home<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>regl one shot rendering example<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- bundle.js is injected here by html-webpack-plugin --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Then, create a minimal CSS file in <code class=\"language-text\">src/css</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token comment\">/* main.css */</span>\n<span class=\"token selector\">h1</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> #0B4192<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And the Javascript files. We’ll put the code in <code class=\"language-text\">one-shot-rendering.js</code> later on. For now, just import the CSS, so you can check that webpack is setup correctly.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// index.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'../css/main.css'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// one-shot-rendering.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'../css/main.css'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Finally, the webpack configuration. I like to include <code class=\"language-text\">BundleAnalyzerPlugin</code> to check the bundle sizes.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// webpack.config.js</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> webpack <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'webpack'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> HtmlWebpackPlugin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html-webpack-plugin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> CleanWebpackPlugin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clean-webpack-plugin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> ExtractTextPlugin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'extract-text-webpack-plugin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> BundleAnalyzerPlugin <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'webpack-bundle-analyzer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  context<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  entry<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    home<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'index.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'one-shot-rendering'</span><span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'one-shot-rendering.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'[name].[chunkhash].bundle.js'</span><span class=\"token punctuation\">,</span>\n    sourceMapFilename<span class=\"token punctuation\">:</span> <span class=\"token string\">'[file].map'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  module<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    rules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token comment\">// rule for .js/.jsx files</span>\n      <span class=\"token punctuation\">{</span>\n        test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.(js|jsx)$/</span><span class=\"token punctuation\">,</span>\n        include<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n          path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        exclude<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n          path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'node_modules'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        use<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// rule for css files</span>\n      <span class=\"token punctuation\">{</span>\n        test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.css$/</span><span class=\"token punctuation\">,</span>\n        include<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'css'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        use<span class=\"token punctuation\">:</span> ExtractTextPlugin<span class=\"token punctuation\">.</span><span class=\"token function\">extract</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> fallback<span class=\"token punctuation\">:</span> <span class=\"token string\">'style-loader'</span><span class=\"token punctuation\">,</span> use<span class=\"token punctuation\">:</span> <span class=\"token string\">'css-loader'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  target<span class=\"token punctuation\">:</span> <span class=\"token string\">'web'</span><span class=\"token punctuation\">,</span>\n  devtool<span class=\"token punctuation\">:</span> <span class=\"token string\">'source-map'</span><span class=\"token punctuation\">,</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">BundleAnalyzerPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">CleanWebpackPlugin</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">[</span><span class=\"token string\">'dist'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> root<span class=\"token punctuation\">:</span> __dirname<span class=\"token punctuation\">,</span> exclude<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'favicon.ico'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> verbose<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      template<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'templates'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'index.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      hash<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'index.html'</span><span class=\"token punctuation\">,</span>\n      chunks<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'commons'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'home'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      template<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'templates'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'one-shot-rendering.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      hash<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'one-shot-rendering.html'</span><span class=\"token punctuation\">,</span>\n      chunks<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'commons'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'one-shot-rendering'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>optimize<span class=\"token punctuation\">.</span>CommonsChunkPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'commons'</span><span class=\"token punctuation\">,</span>\n      filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'[name].[chunkhash].bundle.js'</span><span class=\"token punctuation\">,</span>\n      chunks<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'home'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'one-shot-rendering'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">ExtractTextPlugin</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[name].[chunkhash].bundle.css'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  devServer<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    host<span class=\"token punctuation\">:</span> <span class=\"token string\">'localhost'</span><span class=\"token punctuation\">,</span>\n    port<span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">,</span>\n    contentBase<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    inline<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    stats<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      colors<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      reasons<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      chunks<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      modules<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  performance<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    hints<span class=\"token punctuation\">:</span> <span class=\"token string\">'warning'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Ah, don’t forget <code class=\"language-text\">.babelrc</code>!</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n  &quot;presets&quot;: [&quot;es2015&quot;]\n}</code></pre></div>\n<p>Check that everything works by running <code class=\"language-text\">yarn run dev</code> and going to <code class=\"language-text\">http://localhost:8080/</code>.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/webpack-configured-41e009a31cfaa4d8f7e0df5a27b5b085-61552.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; ; max-width: 301px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 71.42857142857143%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACYElEQVQ4y61US2/aQBDmP/dX9NRLT730VCmqVCWtcqgqQUSqIFqbNwYMfmCDAYMj/MQv7K+zxqRJUaUeamm8uzOz336zM7OV7XYLwzDgui4cx8F8Pi/ENE3oug5juYCsKFBkGZqmY71aYbVew/M8JEmCOI5fSIWBSZKE/X4Py7Kg0ObFYoE1bdK0OVRFhjidYTYVCVgl/QoGgXqejzRJLwHZj510OIQIw5CUCaIoRng4kI4kjGgdFc7MHpR6BuhQVK7rFWzZnI0V/Oev0p9u0BgYuG9peOgb0EwP19UJuImJrniyXddEtCabQn4IazRJ972jo9410Ghr+FgVUeM0bPcHVCT9EVVafKlP8bWpoi9beP+5h9nSxh2v4erbGK/e1CAoFm2a4/ZBxrvrHm7uRLz+wOPtFYebewmfCFQ2nH8LOT5mf7Xlf4ac5znS9FhcdBgklIwEnkOX77HExPDdCCHNAz8ivwxZluNIBzDJ8hNcsSY9wyoYsiw7rg11aGLaMSC2DUy4JeTeCoPGHGNugW5dhW0FJ1bZb155CcpGNqswsLPyMpxn+pyxOj4tsyxDEqelB2NXhryhAh6NBAwHQ5IB+FYHvU4LfLuDFs9T0VNhiyIV9gTtbheysILQ1KEMNxj/1JGW93smdZGUI53MjIwN88nKuzl/SZjC31OhH44kacH0BeCGWmksCOgTQ57joC+XkGYzDIitLEsYkk1TVYwnIkbCEOZuh521pRY0EFIHPQcrAFlLedQ2lvWIHT0UQRAUD4Xv+7DtffFIsDlrLce2qf2iogVZVbDqeEpICfoLp9IibRXnMwAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"The screen you should see if you visit localhost:8080\"\n        title=\"Webpack configured\"\n        src=\"/static/webpack-configured-41e009a31cfaa4d8f7e0df5a27b5b085-61552.png\"\n        srcset=\"/static/webpack-configured-41e009a31cfaa4d8f7e0df5a27b5b085-46cb3.png 148w,\n/static/webpack-configured-41e009a31cfaa4d8f7e0df5a27b5b085-021c3.png 295w,\n/static/webpack-configured-41e009a31cfaa4d8f7e0df5a27b5b085-61552.png 301w\"\n        sizes=\"(max-width: 301px) 100vw, 301px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2>Your first regl command</h2>\n<p>As I said, the regl API provides you with two abstractions: resources and commands. A regl command wraps up all of the WebGL state associated with a draw call (either drawArrays or drawElements) and packages it into a single reusable function.</p>\n<p>Here is what you can define in a regl command:</p>\n<ul>\n<li>vertex shader</li>\n<li>fragment shader</li>\n<li>uniforms</li>\n<li>attributes</li>\n<li>primitive</li>\n<li>count</li>\n</ul>\n<p>That’s a lot of terminology! What are these things?</p>\n<p>I will try to explain these items in a sentence or two, but if you are looking for some more detailed information you should definitely read the article by <a href=\"https://www.toptal.com/javascript/3d-graphics-a-webgl-tutorial\">Adnan Ademovic on the TopTal blog</a>. It’s a great resource and contains a lot of links to master WebGL.</p>\n<p>Here is a summary:</p>\n<p><strong>Vertex shader</strong>.\nA function written in GLSL that runs on your GPU. Its job is to compute vertex positions and set a variable called <code class=\"language-text\">gl_Position</code>. It gets the data from Javascript and can pass other data to the fragment shader.</p>\n<p><strong>Fragment shader</strong>.\nA function written in GLSL that runs on your GPU. Its job is to compute the color of each fragment (you can think of a fragment like a pixel, but the whole story is <a href=\"http://t-machine.org/index.php/2013/10/05/why-is-a-fragment-shader-named-a-fragment-shader/\">more complicated</a> than that).</p>\n<p><strong>Uniforms</strong>.\nGlobal variables that you set in Javascript and that are broadcasted to both shaders. They cannot be changed (something similar to <code class=\"language-text\">const</code> in ES6). They stay the same for all vertices during a single draw call.</p>\n<p><strong>Attributes</strong>.\nData that points to Vertex Buffer Objects. Attributes are used in the vertex shader.</p>\n<p><strong>Primitive</strong>.\nThe primitive type for the <a href=\"http://regl.party/api#elements\">element</a> buffer. WebGL is mostly used to draw triangles, but you can also draw individual points. In regl the supported primitives are: <code class=\"language-text\">&#39;points&#39;</code>, <code class=\"language-text\">&#39;lines&#39;</code>, <code class=\"language-text\">&#39;line strip&#39;</code>, <code class=\"language-text\">&#39;line loop&#39;</code>, <code class=\"language-text\">&#39;triangles&#39;</code>, <code class=\"language-text\">&#39;triangle strip&#39;</code> and <code class=\"language-text\">&#39;triangle fan&#39;</code>.</p>\n<p><strong>Count</strong>.\nThe number of vertices to draw (e.g. if you want to draw 2 triangles you need to set <code class=\"language-text\">count</code> to 6).</p>\n<p>Ok, enough talking. Let’s see some regl action! Open <code class=\"language-text\">one-shot-rendering.js</code> and write this code:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// one-shot-rendering.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'../css/main.css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Create a full screen canvas element and a WebGLRenderingContext.</span>\n<span class=\"token keyword\">const</span> regl <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'regl'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> drawTriangle <span class=\"token operator\">=</span> <span class=\"token function\">regl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// The vertex shader tells the GPU where to draw the vertices.</span>\n  vert<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`\n  precision mediump float;\n\n  uniform float scale;\n  uniform float pointSize;\n  attribute vec2 position;\n  attribute vec3 color;\n  varying vec3 frag_color;  // varying to pass to the fragment shader\n\n  float z = 0.0;\n  float w = 1.0;\n\n  void main () {\n    frag_color = color;\n    gl_PointSize = pointSize;\n    gl_Position = vec4(position * scale, z, w);\n  }\n  `</span></span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// The fragment shader tells the GPU what color to draw.</span>\n  frag<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`\n    precision mediump float;\n  \n    varying vec3 frag_color;  // received from the vertex shader\n  \n    void main () {\n      gl_FragColor = vec4(sqrt(frag_color), 1.0);\n    }\n  `</span></span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// Now that the shaders are defined, we pass the vertices to the GPU</span>\n  attributes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    position<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">[</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.75</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    color<span class=\"token punctuation\">:</span> regl<span class=\"token punctuation\">.</span><span class=\"token function\">prop</span><span class=\"token punctuation\">(</span><span class=\"token string\">'rgbColors'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  uniforms<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// get the prop pointSize and pass it to the shaders</span>\n    pointSize<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> prop<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> prop<span class=\"token punctuation\">.</span>pointSize<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// we can also access the props with this shorthand syntax</span>\n    scale<span class=\"token punctuation\">:</span> regl<span class=\"token punctuation\">.</span><span class=\"token function\">prop</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scale'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// specify the primitive type (the default is 'triangle')</span>\n  primitive<span class=\"token punctuation\">:</span> <span class=\"token string\">'points'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// and we tell the GPU how many vertices to draw</span>\n  count<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// In one-shot rendering the command is executed once and immediately.</span>\n<span class=\"token function\">drawTriangle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  pointSize<span class=\"token punctuation\">:</span> <span class=\"token number\">10.0</span><span class=\"token punctuation\">,</span>\n  scale<span class=\"token punctuation\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n  rgbColors<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Run <code class=\"language-text\">yarn run dev</code> and go to <code class=\"language-text\">http://localhost:8080/</code>. You should see something like this:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/one-shot-rendering-points-a4213d4a29685f95b47fe9b6befcceda-41482.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 24.963924963924967%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAARElEQVQY05WOOQoAMAgE9/9vFWzSCRoDSbDZHDOFYjGIOODpoKWa1hsDcaEGaMx9T5Sdxnz6EgWLfbECIgFV/uF30Cw6wEON2kYnzfkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"One-shot rendering: three points at localhost:8080\"\n        title=\"Three points\"\n        src=\"/static/one-shot-rendering-points-a4213d4a29685f95b47fe9b6befcceda-fb8a0.png\"\n        srcset=\"/static/one-shot-rendering-points-a4213d4a29685f95b47fe9b6befcceda-1a291.png 148w,\n/static/one-shot-rendering-points-a4213d4a29685f95b47fe9b6befcceda-2bc4a.png 295w,\n/static/one-shot-rendering-points-a4213d4a29685f95b47fe9b6befcceda-fb8a0.png 590w,\n/static/one-shot-rendering-points-a4213d4a29685f95b47fe9b6befcceda-41482.png 693w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Well… not that exciting you might say. All that code for three points on the screen?</p>\n<p>Ok, let’s try changing the line <code class=\"language-text\">primitive: &#39;points&#39;</code>. You can either remove it or replace <code class=\"language-text\">&#39;points&#39;</code> with <code class=\"language-text\">&#39;triangle&#39;</code> (the default primitive). Now you should see this:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/one-shot-rendering-triangle-95c21e782a1b14414c9aaeec5269fbb4-d8574.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 23.900293255131967%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAABUUlEQVQY003Q2yvDYRzH8d+fNjeGUqa4IBltRcmFQw5JVsumaKmFthI5l+GCuFhESjnNRmtW22zNsYVtthm/3/P2+1H41Pf59u15vq+LRxJCoEXrilqy8jNreVDSOHLLGF4NTKR7uS7s8yFyv/eoT4X8iVCU731tU9I8DfkPxYsZRm8PqAjaKfW3YvKZaD+rxHKiY95Xw3lkjOe0TwUU/keDJUX+g8LZHFb/FWU7a5RvuGjZmGJw3cnI6giTKxZmFrpYnGnE49Ljdem4XKrn6XCC4n1QxeVvQ9KOwN07/etJSmynlPbvYe7x0texjbXNg8M0h9voZtnoZNM4yl7TMMdNFgLGbkINzcTqqngy11IYtyFCQaTOoRz66kcaahJYzQmmO+J4BqJ47RGOnRGCs1Finhh3WzekdhOkj5LkL+4phlPIySzi5RMK6h9m3hD5PF9R60v+yWu1BgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"One-shot rendering: a triangle at localhost:8080\"\n        title=\"A triangle\"\n        src=\"/static/one-shot-rendering-triangle-95c21e782a1b14414c9aaeec5269fbb4-fb8a0.png\"\n        srcset=\"/static/one-shot-rendering-triangle-95c21e782a1b14414c9aaeec5269fbb4-1a291.png 148w,\n/static/one-shot-rendering-triangle-95c21e782a1b14414c9aaeec5269fbb4-2bc4a.png 295w,\n/static/one-shot-rendering-triangle-95c21e782a1b14414c9aaeec5269fbb4-fb8a0.png 590w,\n/static/one-shot-rendering-triangle-95c21e782a1b14414c9aaeec5269fbb4-d8574.png 682w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>That’s better! Let’s stop for a second and try to explain what’s going on.</p>\n<p>The way we drew this triangle is called <a href=\"http://regl.party/api#one-shot-rendering\">one-shot rendering</a>. The command is executed only once and immediately.</p>\n<p>We called the command with some <strong>props</strong>, which will be available in uniforms and attributes.</p>\n<p>The line <code class=\"language-text\">const regl = require(&#39;regl&#39;)();</code> creates a full screen canvas element and a <code class=\"language-text\">WebGLRenderingContext</code>. This context will be available in the command <code class=\"language-text\">drawTriangle</code> and can be accessed in uniforms and attributes.</p>\n<p>Context and props can be accessed with <code class=\"language-text\">pointSize: (context, prop) =&gt; prop.pointSize,</code>, or even with a shorthand syntax: <code class=\"language-text\">regl.context(&#39;pixelRatio&#39;)</code> and <code class=\"language-text\">regl.prop(&#39;scale&#39;)</code>.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/context-221324eb8bbf32f43d457d577f91bec8-5b410.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 33.69905956112852%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAAxElEQVQoz52QC27DIBBEff8rVk1bqVbi1LEJf8PCKy7uAWKkkXaH0fDEcL3esDrirMe7DWscWhu8d5in/HnOWaw1LRPaXvqd6Z73Ad1yISa2XBjc7JjfFh6XhfVLcf82/NwjtQo5VURKUybnXdLm3ZNjz30+cqVUBr8ElsvK+qnQo2YaIzFUzp4hrAHVqLyKpCik1F+C2ihfVyP0qMkje5HQ1OnqScjBTJblfW1/ODN+KJ5KjsKThHlLyFaIMWKsPV30r1+/JiWlS2eJnwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"regl context\"\n        title=\"The regl context\"\n        src=\"/static/context-221324eb8bbf32f43d457d577f91bec8-fb8a0.png\"\n        srcset=\"/static/context-221324eb8bbf32f43d457d577f91bec8-1a291.png 148w,\n/static/context-221324eb8bbf32f43d457d577f91bec8-2bc4a.png 295w,\n/static/context-221324eb8bbf32f43d457d577f91bec8-fb8a0.png 590w,\n/static/context-221324eb8bbf32f43d457d577f91bec8-5b410.png 638w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>As you can see from the image, the <code class=\"language-text\">drawingBufferWidth</code> is equal to the <code class=\"language-text\">viewportWidth</code>, and the <code class=\"language-text\">drawingBufferHeight</code> is equal to the <code class=\"language-text\">viewportHeight</code>. However, this is true only because we created a <code class=\"language-text\">WebGLRenderingContext</code> without specifying any initialization argument for the regl contructor and because we didn’t set the <code class=\"language-text\">viewport</code>.</p>\n<h2>One canvas, two sizes</h2>\n<p>When you think about the canvas for your regl/WebGL application you need to decide how big you want the canvas to be (e.g. full screen, a small portion of the web page, etc), and how many pixels you want to display.</p>\n<p>In order to illustrate this concept we need to make a few small <a href=\"https://webglfundamentals.org/webgl/lessons/webgl-resizing-the-canvas.html\">changes to the code</a>.</p>\n<p>In your <code class=\"language-text\">one-shot-rendering.html</code>, add a <code class=\"language-text\">&lt;canvas&gt;</code> element.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">&lt;!-- don't change anything above this point --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>regl one shot rendering example<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>regl-canvas<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">&lt;!-- don't change anything below this point --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>You can set the size of the canvas in CSS. In your <code class=\"language-text\">main.css</code> file define a <code class=\"language-text\">canvas</code> selector. Let’s say that you want the canvas to be as wide as half of the viewport width, and as high as half of the viewport height. You can also add a red border to understand where the canvas is.</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token comment\">/* Set the size of the canvas element (i.e. how big the canvas is). */</span>\n<span class=\"token selector\">canvas</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 50vw<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 50vh<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 1px solid #f00<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The size of the canvas has nothing to do with how many pixels you want to have the canvas. For this, you need to modify the Javascript code. In <code class=\"language-text\">one-shot-rendering.js</code>, replace this line:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> regl <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'regl'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>with this code:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'regl-canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> regl <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'regl'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  canvas<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Set the size of the drawingbuffer (i.e. how many pixels are in the canvas)</span>\ncanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>clientWidth<span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">;</span></code></pre></div>\n<p>and in the <code class=\"language-text\">drawTriangle</code> command add the <code class=\"language-text\">viewport</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">viewport<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n  x<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  y<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  width<span class=\"token punctuation\">:</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span>\n  height<span class=\"token punctuation\">:</span> canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/canvas-94487616687224d36ad5c1ee30894c14-c240c.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 49.07801418439717%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABnUlEQVQoz62SW0tbQRCA8798En3ysSCKT96veENoXiI+SEUDohFBxRLbUhSlEQRRgogKSoOoEQURFXLAJF6KBpOYc5KcPZ+76YkabZ/aWYadmZ39mNlZB4kEGAbo+r+pYiSTOHLG/5JMRgIVXYllFahl64stCvy3+TlJp98Ac5t9wbbNZxDSziLy/uvcPwH/CrJFJ/XSmgwLkS2sWoUV0JJAy64wBxJWASiQPqfz4RPNsSqWHjxE08e/iXm2yjclXK18herYNK3XeWzELmk9+0FJ0EX5XhvtuzU4A2WM/CxlOVjHuTbDYyr0figipT/7sgH84V80bgYoXZynct7Lx9nPDHwbx+MdwjvVx9x4F77hClYHiwm4iwl5m4hvfce81rAMXVZoGiSzsLD9SKVbo6htnw/1O3RXb9Ffs4andpkvdT58DXP4G7+y3TxNsGWC09YxtE430R4Xdy4n+pQHcXSI4+IozkD/Pc6OKJO9YfyjEXZnIpz4wmgrYa7WI9ztREkcXKOf3JIN3SNu4pBQHzojJytkq7I9Q75jLMYThEzdfBSQ8ZQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"The canvas is no longer full screen\"\n        title=\"The canvas\"\n        src=\"/static/canvas-94487616687224d36ad5c1ee30894c14-fb8a0.png\"\n        srcset=\"/static/canvas-94487616687224d36ad5c1ee30894c14-1a291.png 148w,\n/static/canvas-94487616687224d36ad5c1ee30894c14-2bc4a.png 295w,\n/static/canvas-94487616687224d36ad5c1ee30894c14-fb8a0.png 590w,\n/static/canvas-94487616687224d36ad5c1ee30894c14-c240c.png 705w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2>Batch rendering</h2>\n<p>With <a href=\"http://regl.party/api#batch-rendering\">batch rendering</a> you can execute a regl command multiple times. The command is executed once for each element of the array passed as argument. Let’s see it in action.</p>\n<p>Create a new HTML file called <code class=\"language-text\">batch-rendering.html</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- batch-rendering.html --></span>\n<span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>x-ua-compatible<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>ie=edge<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>batch rendering<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>description<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>regl example with batch rendering<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- bundle.css is injected here by html-webpack-plugin --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/index.html<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Home<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>regl batch rendering example<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>regl-canvas<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- bundle.js is injected here by html-webpack-plugin --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>You will need to create a new <code class=\"language-text\">entry</code> in webpack, as well as a new configuration for the <code class=\"language-text\">html-webpack-plugin</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// webpack.config.js</span>\nentry<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// other entry points</span>\n  <span class=\"token string\">'batch-rendering'</span><span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'batch-rendering.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// other entry points</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// other configurations of HtmlWebpackPlugin</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  template<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'templates'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'batch-rendering.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  hash<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'batch-rendering.html'</span><span class=\"token punctuation\">,</span>\n  chunks<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'commons'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'batch-rendering'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token comment\">// other configurations of HtmlWebpackPlugin</span></code></pre></div>\n<p>Finally, here is the regl application:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// batch-rendering.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'../css/main.css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'regl-canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> regl <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'regl'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  canvas<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>clientWidth<span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// regl render command to draw a SINGLE triangle</span>\n<span class=\"token keyword\">const</span> drawTriangle <span class=\"token operator\">=</span> <span class=\"token function\">regl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  frag<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`\n  precision mediump float;\n\n  uniform vec4 color;\n\n  void main() {\n    gl_FragColor = color;\n  }\n  `</span></span><span class=\"token punctuation\">,</span>\n\n  vert<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`\n  precision mediump float;\n\n  uniform float angle;\n  uniform vec2 offset;\n  attribute vec2 position;\n\n  float x, y, z, w;\n\n  void main() {\n    x = cos(angle) * position.x + sin(angle) * position.y + offset.x;\n    y = -sin(angle) * position.x + cos(angle) * position.y + offset.y;\n    z = 0.0;\n    w = 1.0;\n    gl_Position = vec4(x, y, z, w);\n  }\n  `</span></span><span class=\"token punctuation\">,</span>\n\n  viewport<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    x<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    y<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    width<span class=\"token punctuation\">:</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span>\n    height<span class=\"token punctuation\">:</span> canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  attributes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// [x,y] positions of the 3 vertices (without the offset)</span>\n    position<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token operator\">-</span><span class=\"token number\">0.25</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span>\n      <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span>\n      <span class=\"token operator\">-</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  uniforms<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Destructure context and pass only tick. Pass props just because we need</span>\n    <span class=\"token comment\">// to pass a third argument: batchId, which gives the index of the regl</span>\n    <span class=\"token comment\">// 'drawTriangle' render command.</span>\n    color<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> tick <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">,</span> batchId<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.02</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span> <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>batchId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>tick <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3.0</span> <span class=\"token operator\">*</span> batchId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> g <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.02</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.02</span> <span class=\"token operator\">*</span> tick<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span> <span class=\"token operator\">*</span> batchId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> b <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.02</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.3</span> <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token number\">2.0</span> <span class=\"token operator\">*</span> batchId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> tick<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.8</span> <span class=\"token operator\">*</span> batchId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> alpha <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">,</span> g<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> alpha<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    angle<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> tick <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">0.01</span> <span class=\"token operator\">*</span> tick<span class=\"token punctuation\">,</span>\n    offset<span class=\"token punctuation\">:</span> regl<span class=\"token punctuation\">.</span><span class=\"token function\">prop</span><span class=\"token punctuation\">(</span><span class=\"token string\">'offset'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// disable the depth buffer</span>\n  <span class=\"token comment\">// http://learningwebgl.com/blog/?p=859</span>\n  depth<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    enable<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  count<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Here we register a per-frame callback to draw the whole scene</span>\nregl<span class=\"token punctuation\">.</span><span class=\"token function\">frame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// clear the color buffer</span>\n  regl<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    color<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// r, g, b, a</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* In batch rendering a regl rendering command can be executed multiple times\n  by passing a non-negative integer or an array as the first argument.\n  The batchId is initially 0 and incremented each time the render command is\n  executed.\n  Note: this command draws a SINGLE triangle, but since we are passing an\n  array of 5 elements it is executed 5 times. */</span>\n  <span class=\"token function\">drawTriangle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> offset<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// props0</span>\n    <span class=\"token punctuation\">{</span> offset<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">0.15</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.15</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// props1...</span>\n    <span class=\"token punctuation\">{</span> offset<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.15</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.15</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> offset<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> offset<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/batch-rendering-e7847fb39373d691e8878fda4257cf62-d5231.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50.78459343794579%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABz0lEQVQoz62Sz2sTQRiGv9nZ3ZTE0LDdBi/WaLAIhVhPRRNb28SyjSJIodCkERovHkQLOdhCD70UCgVRRGjRm0IFD4pCwYMI/rj4Hwie9aIHj158nMwuJGBPIsMzO9/sN++8883I9sYGjfl5rjWbLC81erT6aBoWF1luNA6kbWgtLLC+soJMjI8jIv+FkXwemZ2atEFq0CczlSZTTZO9nGHwapZgLcfQeo70RAbtptApH+15ZuyilUKbddpx8Ezc1Tg1OopUKxUbONoh3As4xoilwBGG90N0deBgR76PDIeI1qhkbqxYNILlsg2UKMQR8q9C8i9DvJOedRAYcu0WsruLengf9fwp6uMb1LMnyMUIMU6VoSfY59DurBMHQ8LhK4qtd8KNHyVcvqEA5+dX1PYmcrwQ55kjK+PSChYKfYLmhyiJ6SY2DbY5tvc/n0at3kayh/46vkpKMFYqIRcm40vxusU2O2nX4BnEcFPjfNH4tzwGQokv4UQRvXMP/eAO+vEj9Nt93PevkbUOpUr5H5/Nzl3j+Tfy6zvyYg85d8bOHw0CZLXT4fz0NPV6nSiKeswlzBouJeNuzsxM/P30gWhrk8iUbO5smVqtxvV2mz/7JC3H2hkmngAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Five triangle with batch rendering and the frame loop\"\n        title=\"Batch rendering\"\n        src=\"/static/batch-rendering-e7847fb39373d691e8878fda4257cf62-fb8a0.png\"\n        srcset=\"/static/batch-rendering-e7847fb39373d691e8878fda4257cf62-1a291.png 148w,\n/static/batch-rendering-e7847fb39373d691e8878fda4257cf62-2bc4a.png 295w,\n/static/batch-rendering-e7847fb39373d691e8878fda4257cf62-fb8a0.png 590w,\n/static/batch-rendering-e7847fb39373d691e8878fda4257cf62-d5231.png 701w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2>GLSL? There is a loader for that!</h2>\n<p>I don’t know about you, but defining shaders with back ticks looks awful to me. It would be much better to write <code class=\"language-text\">.glsl</code> files and then load them in a regl application. We could use linters and autocompletion, but even more importantly, we would avoid copy pasting the shaders in JS every single time we need them.</p>\n<p>Luckily with Webpack it’s pretty easy to fix this issue. There is a loader for that!</p>\n<p>Ok, so you need to do these things:</p>\n<ol>\n<li>add <code class=\"language-text\">webpack-glsl-loader</code> to <code class=\"language-text\">devDependencies</code></li>\n<li>create <code class=\"language-text\">.glsl</code> files for the vertex shader and for the fragment shader</li>\n<li>configure webpack to load <code class=\"language-text\">.glsl</code> files with <code class=\"language-text\">webpack-glsl-loader</code></li>\n<li><code class=\"language-text\">require</code> the shaders in the regl application</li>\n</ol>\n<p>As an example, we’ll remove the shader code between the back ticks in <code class=\"language-text\">batch-rendering.js</code> and we’ll use the GLSL loader instead.</p>\n<p>Install the GLSL loader with <code class=\"language-text\">yarn add --dev webpack-glsl-loader</code>.</p>\n<p>Create GLSL files for your shaders. Create <code class=\"language-text\">src/glsl/vertex/batch.glsl</code> for the vertex shader and <code class=\"language-text\">src/glsl/fragment/batch.glsl</code> for the fragment shader. You just have to copy and paste the code between the back ticks in <code class=\"language-text\">batch-rendering.js</code>.</p>\n<p>Configure webpack to use <code class=\"language-text\">webpack-glsl-loader</code> to load <code class=\"language-text\">.glsl</code> files.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// webpack.config.js</span>\n<span class=\"token comment\">// rule for .glsl files (shaders)</span>\n<span class=\"token punctuation\">{</span>\n  test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.glsl$/</span><span class=\"token punctuation\">,</span>\n  use<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'webpack-glsl-loader'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Finally, <code class=\"language-text\">require</code> your shaders in <code class=\"language-text\">batch-rendering.js</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// batch-rendering.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'../css/main.css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> vertexShader <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../glsl/vertex/batch.glsl'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fragmentShader <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../glsl/fragment/batch.glsl'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'regl-canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> regl <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'regl'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  canvas<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>clientWidth<span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// regl render command to draw a SINGLE triangle</span>\n<span class=\"token keyword\">const</span> drawTriangle <span class=\"token operator\">=</span> <span class=\"token function\">regl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n  vert<span class=\"token punctuation\">:</span> vertexShader<span class=\"token punctuation\">,</span>\n  frag<span class=\"token punctuation\">:</span> fragmentShader<span class=\"token punctuation\">,</span>\n\n  viewport<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    x<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    y<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    width<span class=\"token punctuation\">:</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span>\n    height<span class=\"token punctuation\">:</span> canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  attributes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// [x,y] positions of the 3 vertices (without the offset)</span>\n    position<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token operator\">-</span><span class=\"token number\">0.25</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span>\n      <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span>\n      <span class=\"token operator\">-</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  uniforms<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Destructure context and pass only tick. Pass props just because we need</span>\n    <span class=\"token comment\">// to pass a third argument: batchId, which gives the index of the regl</span>\n    <span class=\"token comment\">// 'drawTriangle' render command.</span>\n    color<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> tick <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">,</span> batchId<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.02</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span> <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>batchId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>tick <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3.0</span> <span class=\"token operator\">*</span> batchId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> g <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.02</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.02</span> <span class=\"token operator\">*</span> tick<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span> <span class=\"token operator\">*</span> batchId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> b <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.02</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.3</span> <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token number\">2.0</span> <span class=\"token operator\">*</span> batchId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> tick<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.8</span> <span class=\"token operator\">*</span> batchId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> alpha <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">,</span> g<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> alpha<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    angle<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> tick <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">0.01</span> <span class=\"token operator\">*</span> tick<span class=\"token punctuation\">,</span>\n    offset<span class=\"token punctuation\">:</span> regl<span class=\"token punctuation\">.</span><span class=\"token function\">prop</span><span class=\"token punctuation\">(</span><span class=\"token string\">'offset'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// disable the depth buffer</span>\n  <span class=\"token comment\">// http://learningwebgl.com/blog/?p=859</span>\n  depth<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    enable<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  count<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Here we register a per-frame callback to draw the whole scene</span>\nregl<span class=\"token punctuation\">.</span><span class=\"token function\">frame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  regl<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    color<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// r, g, b, a</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* In batch rendering a regl rendering command can be executed multiple times\n  by passing a non-negative integer or an array as the first argument.\n  The batchId is initially 0 and incremented each time the render command is\n  executed.\n  Note: this command draws a SINGLE triangle, but since we are passing an\n  array of 5 elements it is executed 5 times. */</span>\n  <span class=\"token function\">drawTriangle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> offset<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// props0</span>\n    <span class=\"token punctuation\">{</span> offset<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">0.15</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.15</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// props1...</span>\n    <span class=\"token punctuation\">{</span> offset<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.15</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.15</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> offset<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> offset<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Hungarian notation?</h2>\n<p>On <a href=\"https://webglfundamentals.org/webgl/lessons/webgl-shaders-and-glsl.html\">WebGL Fundamentals</a> they say that it’s common practice to place a letter in front of the variables to indicate their type: <code class=\"language-text\">u</code> for <code class=\"language-text\">uniforms</code>, <code class=\"language-text\">a</code> for <code class=\"language-text\">attributes</code> and the <code class=\"language-text\">v</code> for <code class=\"language-text\">varyings</code>. I’m not a huge fan of this <a href=\"https://en.wikipedia.org/wiki/Hungarian_notation\">Hungarian notation</a> though. I don’t think it really improves the readability of the code and I don’t think I will use it.</p>\n<h2>Conclusion</h2>\n<p>I plan to write several articles about regl in the near future. In this one we learned how to configure Webpack for regl applications. In the next one I will create a few examples with d3 and regl.</p>\n<p>Stay tuned!</p>","frontmatter":{"title":"How to get started with regl and Webpack","date":"October 31, 2017"}}},"pageContext":{"slug":"/2017-10-31-how-to-get-started-with-regl-and-webpack/","previous":{"fields":{"slug":"/2017-10-14-a-5-minute-intro-to-hypothesis/"},"frontmatter":{"title":"A 5 minute Intro to Hypothesis"}},"next":{"fields":{"slug":"/2017-12-10-reactive-dashboards-with-plotly-dash/"},"frontmatter":{"title":"Reactive Dashboards with Plotly Dash"}}}}