{"data":{"site":{"siteMetadata":{"title":"Giacomo Debidda","author":"Giacomo Debidda"}},"markdownRemark":{"id":"6060ae84-d98b-5f78-9471-61779a201def","excerpt":"I have recently switched from D3 v3.0 to D3 v4.0, and I have already encountered some important changes. For example, the scaling functions…","html":"<p>I have recently switched from D3 v3.0 to D3 v4.0, and I have already encountered some important changes. For example, the scaling functions are quite different, and the <a href=\"https://github.com/d3/d3-3.x-api-reference/blob/master/Layouts.md\">old layouts available in the older API</a> have been moved and renamed. In fact, D3 v4.0 is no longer a single library, but many small libraries (about 30) that are designed to work together.</p>\n<p>For a weekend project I wanted to create a visualization of a simple graph with nodes and edges. In D3 v3.0 this can be done with <code class=\"language-text\">d3.layout.force</code>. In D3 v4.0 this is a job for <code class=\"language-text\">d3.forceSimulation</code>.</p>\n<h2>Looking for some data</h2>\n<p>I started looking for JSON files that contained the necessary information to represent a small social network graph. To my surprise, I didn’t find any. Instead, I found some small network data sets as GML files <a href=\"https://networkdata.ics.uci.edu/index.php\">here</a> and <a href=\"http://www-personal.umich.edu/~mejn/netdata/\">here</a>. I had never heard of the GML file format before, but since I liked these data sets I decided to proceed. At the end of the article you can see a visualization of a small social network of dolphins (62 nodes, 159 edges). The original file (<code class=\"language-text\">dolphins.gml</code>) was found on <a href=\"https://networkdata.ics.uci.edu/data.php?id=6\">this page</a> of the University of California Irvine.</p>\n<h2>GML (Graph Modelling Language)</h2>\n<p>The <a href=\"https://networkx.github.io/documentation/networkx-1.10/reference/readwrite.gml.html\">Graph Modelling Language</a>, not to be confused with the <a href=\"https://en.wikipedia.org/wiki/Geography_Markup_Language\">Geography Markup Language</a>, is a portable file format for graphs.</p>\n<p>A GML file looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"># dolphins.gml\nCreator &quot;Mark Newman on Wed Jul 26 15:04:20 2006&quot;\ngraph\n[\n  directed 0\n  node\n  [\n    id 0\n    label &quot;Beak&quot;\n  ]\n  node\n  [\n    id 1\n    label &quot;Beescratch&quot;\n  ]\n  # more nodes here...\n  edge\n  [\n    source 8\n    target 3\n  ]\n  edge\n  [\n    source 9\n    target 5\n  ]\n  # more edges here...\n]</code></pre></div>\n<p>It doesn’t look to different from a JSON file, but the problem is that D3 cannot load it directly. After a brief Google search I found out that I could use a Python library to load the GML file and convert it into JSON.</p>\n<h2>NetworkX</h2>\n<p><a href=\"http://networkx.readthedocs.io/en/networkx-1.11/index.html\">NetworkX</a> is a Python package for the creation, manipulation, and study of the structure, dynamics, and functions of complex networks. It’s distributed with a BSD license and was developed by Aric Hagberg, Dan Schulz and Pieter Swart.</p>\n<p>In NetworkX one can create graphs for undirected and directed networks, add and remove nodes and edges in different ways, visualize the network and export network data to draw it with an external tool.</p>\n<p>In order to visualize the network data you can use the <code class=\"language-text\">networkx.draw</code> function and save the image as a PNG with <code class=\"language-text\">matplotlib</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> networkx <span class=\"token keyword\">as</span> nx\n<span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pylab <span class=\"token keyword\">as</span> plt\n\ng <span class=\"token operator\">=</span> nx<span class=\"token punctuation\">.</span>read_gml<span class=\"token punctuation\">(</span><span class=\"token string\">'dolphins.gml'</span><span class=\"token punctuation\">)</span>\nnx<span class=\"token punctuation\">.</span>draw<span class=\"token punctuation\">(</span>g<span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>savefig<span class=\"token punctuation\">(</span><span class=\"token string\">'dolphins.png'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Apparently there must be some randomness when the figure gets generated, because I ran the code twice and I got 2 different PNG images.</p>\n<p>Here is the first one:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dolphins_1-4eab9d2e07d95e90da153bcaf3fe770e-b4c1c.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA9hAAAPYQGoP6dpAAACUklEQVQ4y21Uy07qUBTt1zlx5A848iucOHCgMxMdqNGoiQ6MUa9GroqgiQ+EXIIRLxEvYniIQCkt79Ja6Lr7QE85NuzkpO15rK5HdyU4Zdv2YLj3/f7PZ37P5p01cZ2X5E4IB8TiB9lqv9MZzfPhAZXcCQHMtix0np4GV2c37HYb9YcHyAcHaMdiQK8Hmw1+xnmx5AVrv7ygcnSERjLpbjQMA5Xra5RKJRSfn1E+O0P55mbElqtigKIkI5dD7e4O2tcXvgmk9f6OWrOJpqpCJsA0MXsj5h+Pj/iztYXE7CyajC33lgNyloX9fWiVCpRCAXI6DYUkMtF6qwWFwNVUCmokgu9uFw1NQ3B+HtHp6ZFlA0AuNRpF/vAQf1dXEZqZQV1RoFMIlYsLqHTYos26af4ITIvHEZuYQCeRcFlKzFhWqs+H7N4e4uvr+L27i/DSEkrhMNR8frDeI0DT2cuKMWfwOXpheWfHDdOVbDUaeCWQyOYmrujqm5rCPYEniTWzoVYsQqdQLF1Hl85ULy/RJwDl+Bi18/MhIL1w5CF9Fg2inqINt3NzuF9ZQZzMZ8nmSVru5AQqBdYlKxhbq1pFjwWWzQ6A+RchibH3CVQjwI/TUwQWFhCiUQ+FwIQaFIS32hSQ7ljCMSSxhXokx5RlqBRQYmMDvyYn4V9cRCoQQI0sYVLrmQyaxNSmgOwxLSuJLcbLIL8sYpvZ3sa/5WWkg0G8rq2hTIxUvx8dssAWW1NsPXj6UQQepjX0xyCvzM/PsX0OL+A4UPeP4mEv/m28ylj9B3kfZhohr2prAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"The figure generated when dolphins.gml is drawn, the first time\"\n        title=\"The figure generated when dolphins.gml is drawn, the first time\"\n        src=\"/static/dolphins_1-4eab9d2e07d95e90da153bcaf3fe770e-fb8a0.png\"\n        srcset=\"/static/dolphins_1-4eab9d2e07d95e90da153bcaf3fe770e-1a291.png 148w,\n/static/dolphins_1-4eab9d2e07d95e90da153bcaf3fe770e-2bc4a.png 295w,\n/static/dolphins_1-4eab9d2e07d95e90da153bcaf3fe770e-fb8a0.png 590w,\n/static/dolphins_1-4eab9d2e07d95e90da153bcaf3fe770e-b4c1c.png 800w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>and the second one:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dolphins_2-6f559d132b4042a1a05f64260c60b691-b4c1c.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA9hAAAPYQGoP6dpAAACTklEQVQ4y3VU207qQBTlR/0RjS/6Yky8xQeNRuPtxUSNMXpMjEqQY4IGRAJyExWUm2Kh3NvSdp01PVRLxZ00GWb2rFl77bXxwBGmaVqftTYMmPgZpn1m55mDWR4nGOwkXf+/2etBa7XQlSQo5TIMruEAGAbqcW+I10XomobKwQGkZBJSLIbc2hpyW1sobG6ik07DaDYH8u3qPMPKbd7fIzU3h/jxMVSxUa8jcXqK8N4egtPTSO7vQ+JvNwkL0KmZKKejqiheXKBaLKJQqSC6vY2H3V1EfD4kbm/hn5zEn6kpxJaWULq8hM7HnFV6nC+oHx/Ik5XCtRyPo8XSPms1hAjqHRnB9coKArOzSF1dodpo4D0Swevy8nf5ToY9Ci8HAmi021YnpXAY+cNDSGQsETjAMn07O/i7uIjUxgbeg0GwRWgxr02dbWJfgIJ6iWVJ0SgaTK6RgWBoRyWVwvX4OPyjo0iyMWW/H59eL7oOMKtke9HNZPC6uoo0G1J7e4MiyxDm6dAqQtd2Nos4gaIEqioKdN7TOx2ohcJgl23Ptc/P8ciysnd3iLGbRQre46UeL4tmacwp8kx6esJLLofs+jpZdH/vskHxn9m9TCiEm/l5PBLQDoUMVQLL1NmeFunsDAZlcVvuh7HloyOUT05ws7CAB2omrNEgkPCjYF1PJGBygmxguEfPQu8fmP3mWKx4MTMzg8zEBKK0ywu1S9E++bExS7svZi7Qb2M7Z5O6Ot81CGByFDWaXSuVBnT7fZb7r9l6WJ/4V3FcHDZq7vgHZE5kk0SrhvwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"The figure generated when dolphins.gml is drawn, the second time\"\n        title=\"The figure generated when dolphins.gml is drawn, the second time\"\n        src=\"/static/dolphins_2-6f559d132b4042a1a05f64260c60b691-fb8a0.png\"\n        srcset=\"/static/dolphins_2-6f559d132b4042a1a05f64260c60b691-1a291.png 148w,\n/static/dolphins_2-6f559d132b4042a1a05f64260c60b691-2bc4a.png 295w,\n/static/dolphins_2-6f559d132b4042a1a05f64260c60b691-fb8a0.png 590w,\n/static/dolphins_2-6f559d132b4042a1a05f64260c60b691-b4c1c.png 800w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>The network data can also be exported and visualized in a program like GraphViz or Gephi, or, like I will do here, in D3.</p>\n<p>I didn’t play with NetworkX too much, but from what I’ve seen <a href=\"http://networkx.readthedocs.io/en/networkx-1.11/tutorial/\">the documentation is great</a>. There is also a nice presentation <a href=\"https://www.cl.cam.ac.uk/~cm542/teaching/2010/stna-pdfs/stna-lecture8.pdf\">here</a>.</p>\n<p>Here is the snippet of code to convert a GML file into a JSON file:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> networkx <span class=\"token keyword\">as</span> nx\n<span class=\"token keyword\">import</span> simplejson <span class=\"token keyword\">as</span> json\n<span class=\"token keyword\">from</span> networkx<span class=\"token punctuation\">.</span>readwrite <span class=\"token keyword\">import</span> json_graph\n\n<span class=\"token comment\"># parse the gml file and build the graph object</span>\ng <span class=\"token operator\">=</span> nx<span class=\"token punctuation\">.</span>read_gml<span class=\"token punctuation\">(</span><span class=\"token string\">'dolphins.gml'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># create a dictionary in a node-link format that is suitable for JSON serialization</span>\nd <span class=\"token operator\">=</span> json_graph<span class=\"token punctuation\">.</span>node_link_data<span class=\"token punctuation\">(</span>g<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dolphins.json'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'w'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> fp<span class=\"token punctuation\">:</span>\n    json<span class=\"token punctuation\">.</span>dump<span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">,</span> fp<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Note that the GML file I used with the latest NetworkX version (1.11) caused the Exception <code class=\"language-text\">networkx.exception.NetworkXError: cannot tokenize u&#39;graph&#39; at (2, 1)</code>. I downgraded NetworkX to version 1.9.1 as suggestes in <a href=\"https://www.bountysource.com/issues/27097685-problem-reading-gml-file\">this thread</a> and it worked fine. Another approach would have been to <a href=\"http://stackoverflow.com/questions/32895291/unexpected-error-reading-gml-graph/37819717#37819717\">format the GML file in a different way</a>.</p>\n<h2>The D3 visualization</h2>\n<p>Finally, with the network data available as <code class=\"language-text\">dolphins.json</code>, we can use <code class=\"language-text\">d3.json</code> to read it. Drag a node or hover on it to know the name of the dolphins in this network!</p>\n<figure class=\"dolphins-graph\"></figure>\n<h2>References</h2>\n<p>The file <code class=\"language-text\">dolphins.gml</code> contains an undirected social network of frequent associations between 62 dolphins in a community living off Doubtful Sound,\nNew Zealand, as compiled by Lusseau et al. (2003).</p>\n<p><em>D. Lusseau, K. Schneider, O. J. Boisseau, P. Haase, E. Slooten, and S. M. Dawson, The bottlenose dolphin community of Doubtful Sound features a large proportion of long-lasting associations, Behavioral Ecology and Sociobiology 54, 396-405 (2003).</em></p>\n<p>Additional information on the network can be found in:</p>\n<ul>\n<li>\n<p><em>D. Lusseau, The emergent properties of a dolphin social network, Proc. R. Soc. London B (suppl.) 270, S186-S188 (2003).</em></p>\n</li>\n<li>\n<p><em>D. Lusseau, <a href=\"http://arxiv.org/abs/q-bio.PE/0607048\">Evidence for social role in a dolphin social network</a>, Preprint q-bio/0607048</em></p>\n</li>\n</ul>","frontmatter":{"title":"Visualize GML files with D3","date":"January 12, 2017"}}},"pageContext":{"slug":"/2017-01-06-visualize-gml-files-with-d3/","previous":{"fields":{"slug":"/2016-12-29-interesting-things-other-people-did-in-2016/"},"frontmatter":{"title":"Interesting things other people did in 2016"}},"next":{"fields":{"slug":"/2017-01-21-bridge-pattern-in-python/"},"frontmatter":{"title":"Bridge pattern in Python"}}}}