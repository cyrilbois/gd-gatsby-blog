{"data":{"site":{"siteMetadata":{"title":"Giacomo Debidda","author":"Giacomo Debidda","description":"Giacomo Debidda's Personal Blog"}},"markdownRemark":{"id":"9de8317c-4eca-5875-82e4-2bcfb2c3c7d9","excerpt":"Strategy  (also known as  Policy ) is a behavioral design pattern that enables an algorithm’s behavior to be selected at runtime. All…","timeToRead":4,"html":"<p><em>Strategy</em> (also known as <em>Policy</em>) is a behavioral design pattern that enables an algorithm’s behavior to be selected at runtime.</p>\n<p>All implemented behaviors are either classes, methods, or functions, and they are usually called <em>strategies</em>. The portion of code that decides which strategy to adopt is called <em>context</em>.</p>\n<p>Strategy follows two important principles:</p>\n<ul>\n<li>Open/closed principle: software entities (classes, modules, functions, etc.) should be open for extension, but closed for modification.</li>\n<li>Inversion of Control principle: custom-written portions of a program (e.g. a method in a subclass) receive the flow of control from a generic framework (e.g. a base class).</li>\n</ul>\n<p>Following these two principles is extremely useful when you want to design a common interface (the <em>Closed</em> part of the Open/Closed principle), but allow for changes in the implementation details (the <em>Open</em> part of the Open/Closed principle). Every time you want to program a new implementation, you pass it to the common interface without altering anything in the interface code, and you plug the client code to the interface. This way the client code is <em>loosely coupled</em>, namely it is coupled only with an abstraction (i.e. the common interface), not with the concrete implementations (i.e. the various strategies).</p>\n<h2>How to implement a Strategy pattern in Python?</h2>\n<p>In programming languages like Java you can implement the Strategy pattern by creating a common (abstract) interface and subclassing it with a new class for each strategy. You can do the same in Python, like it’s done <a href=\"http://python-3-patterns-idioms-test.readthedocs.io/en/latest/FunctionObjects.html#strategy-choosing-the-algorithm-at-runtime\">here</a>. However, you can also use a leaner approach: create a single <code class=\"language-text\">Strategy</code> class and replace a method of that class, at runtime, with a different function based on a given context.</p>\n<p>Enough talking, let’s see some code!</p>\n<h2>The <code class=\"language-text\">Strategy</code> class</h2>\n<p>This class is the interface that the client code will use. It represents the <em>Closed</em> part of the Open/Closed principle, so it should not be modified.</p>\n<p>If the client code does not provide a function <code class=\"language-text\">func</code>, <code class=\"language-text\">Strategy</code> will use the default algorithm, namely <code class=\"language-text\">execute</code> in this example.</p>\n<p>In the <code class=\"language-text\">__init__</code> method we are taking advantage of the fact that Python supports <strong>higher order functions</strong>, namely we can pass a function as an argument to another function, and that Python functions are <strong>first class objects</strong>, so they can be assigned to variables, or stored in data structures (e.g. a dict).</p>\n<p>If the client provides a function <code class=\"language-text\">func</code>, this will be passed to the <code class=\"language-text\">__init__</code> method and assigned to the <code class=\"language-text\">execute</code> method. This means that the <code class=\"language-text\">execute</code> method will be redefined when the <code class=\"language-text\">Strategy</code> class is <em>instantiated</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> func<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> func <span class=\"token keyword\">is</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>execute <span class=\"token operator\">=</span> func\n            self<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'{}_{}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__name__<span class=\"token punctuation\">,</span> func<span class=\"token punctuation\">.</span>__name__<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'{}_default'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__name__<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Default method'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'{}\\n'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>That’s cool, but there is a problem: <code class=\"language-text\">func</code> is <strong>just a function</strong>, it contains no reference to the instance it is bound to (like a Python method defined by using the <code class=\"language-text\">@staticmethod</code> decorator). Within the redefined <code class=\"language-text\">execute</code> you cannot access other methods or attributes of the instance.</p>\n<p>However with some Python magic and the help of the <code class=\"language-text\">types</code> module you can convert a normal function into a bound method, namely a function that contains a reference to the instance it is bound to.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> types\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> func<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> func <span class=\"token keyword\">is</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># take a function, bind it to this instance, and replace the default bound method 'execute' with this new bound method.</span>\n            self<span class=\"token punctuation\">.</span>execute <span class=\"token operator\">=</span> types<span class=\"token punctuation\">.</span>MethodType<span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span>\n            self<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'{}_{}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__name__<span class=\"token punctuation\">,</span> func<span class=\"token punctuation\">.</span>__name__<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'{}_default'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__name__<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Default method'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'{}\\n'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now it’s time to implement some <em>strategies</em>.</p>\n<h2>Implement the <em>strategies</em></h2>\n<p>Let’s define a couple of <em>replacement strategies</em> for the default method <code class=\"language-text\">execute</code>. Don’t mind the <code class=\"language-text\">self</code> parameter, for now these ones are just regular functions. I decided to use <code class=\"language-text\">self</code> because I know that these functions, passed to the <code class=\"language-text\">Strategy</code>’s <code class=\"language-text\">__init__</code> method, will be bound to an instance of <code class=\"language-text\">Strategy</code> (this is done when the line <code class=\"language-text\">types.MethodType(func, self)</code> is executed).</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">execute_replacement1</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Replacement1 method'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'{}\\n'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">execute_replacement2</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Replacement2 method'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'{}\\n'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Select a strategy at runtime</h2>\n<p>In this simple example the part of the program which decides which strategy to use, namely the <em>context</em>, is the <code class=\"language-text\">main</code> function. As you can see, the three instances of <code class=\"language-text\">Strategy</code> are calling the same method.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    s0 <span class=\"token operator\">=</span> Strategy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    s0<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    s1 <span class=\"token operator\">=</span> Strategy<span class=\"token punctuation\">(</span>execute_replacement1<span class=\"token punctuation\">)</span>\n    s1<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    s2 <span class=\"token operator\">=</span> Strategy<span class=\"token punctuation\">(</span>execute_replacement2<span class=\"token punctuation\">)</span>\n    s2<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>This is the output:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> Default method\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> Strategy_default\n\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> Replacement1 method\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> Strategy_execute_replacement1\n\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> Replacement2 method\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> Strategy_execute_replacement2</code></pre></div>\n<h2>An even simpler Strategy</h2>\n<p>Sometimes you don’t even have to create a class, and you can achieve a similar result by assigning a function to an object, and then later calling that object. For example, this is also a Strategy:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">subtract</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> a <span class=\"token operator\">-</span> b\n\nsolve <span class=\"token operator\">=</span> add\nsolve<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span>\n\nsolve <span class=\"token operator\">=</span> subtract\nsolve<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Strategy VS Template Method</h2>\n<p>Strategy and <a href=\"http://www.giacomodebidda.com/blog/template-method-pattern-in-python/\">Template Method</a> are very similar and follow the same principles. The main difference is that in Template Method an implementation is chosen at <em>compile time</em> by <em>inheritance</em>, while in Strategy is chosen at <em>runtime</em> by <em>containment</em>. See also <a href=\"http://stackoverflow.com/a/669366\">here</a> to understand the difference between these two behavioral design patterns.</p>\n<p>You need the code? Grab it <a href=\"https://github.com/jackaljack/design-patterns\">here</a>!</p>","frontmatter":{"title":"Strategy pattern in Python","date":"January 28, 2017"}}},"pageContext":{"slug":"/strategy-pattern-in-python/","previous":{"fields":{"slug":"/template-method-pattern-in-python/"},"timeToRead":5,"frontmatter":{"title":"Template Method pattern in Python","path":"/template-method-pattern-in-python/"}},"next":{"fields":{"slug":"/factory-method-and-abstract-factory-in-python/"},"timeToRead":6,"frontmatter":{"title":"Factory Method and Abstract Factory in Python","path":"/factory-method-and-abstract-factory-in-python/"}}}}