{"data":{"site":{"siteMetadata":{"title":"Giacomo Debidda","author":"Giacomo Debidda"}},"markdownRemark":{"id":"34f58020-4b99-5132-b8a5-9063837082d5 >>> MarkdownRemark","excerpt":"Here is an unordered list of git commands, configurations, tricks, articles, gotchas that I don’t want to forget. Find out all commit hashes…","html":"<p>Here is an unordered list of git commands, configurations, tricks, articles, gotchas that I don’t want to forget.</p>\n<ul>\n<li>Find out all commit hashes of the git submodules your branch is pointing at</li>\n<li>Find commit by message string</li>\n<li>Show all commits from an author, in a specified date range</li>\n<li>Fix <code class=\"language-text\">.git/index.lock</code> error</li>\n<li>Permanently remove a file from a repo</li>\n<li>Show branch name in Linux terminal</li>\n<li>Compare a file across 2 branches</li>\n<li>List all commits for a specific file</li>\n<li>Configure git aliases</li>\n<li>Commit only part of a file</li>\n<li>Git hooks</li>\n<li>Discard changes to git submodules</li>\n</ul>\n<hr>\n<h2>Find out all commit hashes of the git submodules your branch is pointing at</h2>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>git&nbsp;ls-tree&nbsp;&lt;branch&nbsp;you&nbsp;are&nbsp;currently&nbsp;on&gt;:&lt;path&nbsp;to&nbsp;directory&nbsp;containing&nbsp;the&nbsp;submodules&gt;</span></span></div></pre></div>\n<p><em>Example</em> </p>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>git&nbsp;ls-tree&nbsp;master:external</span></span></div></pre></div>\n<p>Reference <a href=\"https://stackoverflow.com/a/5033973\">here</a></p>\n<h2>Find commit by message string</h2>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>git&nbsp;log&nbsp;--all&nbsp;--grep=&quot;your&nbsp;commit&nbsp;message&nbsp;here&nbsp;(or&nbsp;part&nbsp;of&nbsp;it)&quot;</span></span></div></pre></div>\n<p>Use <code class=\"language-text\">--all</code> to search across all branches. Don’t use it if you want to restrict the search to the branch you are currently on.</p>\n<p>Reference <a href=\"https://stackoverflow.com/a/7124949\">here</a></p>\n<h2>Show all commits from an author, in a specified date range</h2>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>git&nbsp;log&nbsp;--pretty=format:&quot;%ad&nbsp;-&nbsp;%an:&nbsp;%s&quot;&nbsp;--after=&quot;2016-01-31&quot;&nbsp;--until=&quot;2017-12-01&quot;&nbsp;--author=&quot;John&nbsp;Doe&quot;</span></span></div></pre></div>\n<p>Reference <a href=\"https://stackoverflow.com/a/42795304/3036129\">here</a> and <a href=\"https://git-scm.com/book/it/v2/Git-Basics-Viewing-the-Commit-History\">here</a></p>\n<h2>Fix <code class=\"language-text\">.git/index.lock</code></h2>\n<p>I get this from time to time, and I still haven’t figured out the reason why it occurs.\nYou just have to remove the <code class=\"language-text\">index.lock</code> file (not the index!).</p>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>rm&nbsp;.git/index.lock</span></span></div></pre></div>\n<p>Reference <a href=\"https://robots.thoughtbot.com/how-to-fix-rm-f-git-index\">here</a></p>\n<h2>Permanently remove a file from a repo</h2>\n<p>You should really think twice before performing this operation. Also, keep in mind that this command will override git history.</p>\n<p>Anyway, there are some real use cases when this command is useful.</p>\n<p>Let’s say that you commit a large file by mistake. You have some stuff to commit and you run a convenient <code class=\"language-text\">git add .</code> to stash all your changes. Then you forget to review your changes and those changes end up in the commit history. At this point you are still on a local branch, so you can still save the day by removing the file, stashing your changes once again and running a <code class=\"language-text\">git commit --amend</code>. If you realize your mistake some commits later, but you have not yet pushed them, you can also <a href=\"https://www.giacomodebidda.com/squashing-git-commits/\">squash your commits</a>. But if you have already pushed to your remote repository you are out of luck, and that’s when this command could help you.</p>\n<p>Let’s suppose that at some point in time you created a <code class=\"language-text\">README.md</code> for your project, but for some esoteric reason you want to remove it from your project. You can permanently remove your <code class=\"language-text\">README.md</code> file and make it disappear from your git history with the following command.</p>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>git&nbsp;filter-branch&nbsp;--tree-filter&nbsp;&#39;rm&nbsp;-rf&nbsp;README.md&#39;&nbsp;HEAD</span></span></div></pre></div>\n<p>If you now run <code class=\"language-text\">git status</code>, you will notice that your local branch and your remote branch differ. That’s because your remote branch still has a <code class=\"language-text\">README.md</code> in its history.</p>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>jack@ThinkJack:~/Repos/d3-visualizations(master)$&nbsp;git&nbsp;status</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>On&nbsp;branch&nbsp;master</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>Your&nbsp;branch&nbsp;and&nbsp;&#39;origin/master&#39;&nbsp;have&nbsp;diverged,</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>and&nbsp;have&nbsp;26&nbsp;and&nbsp;26&nbsp;different&nbsp;commits&nbsp;each,&nbsp;respectively.</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;(use&nbsp;&quot;git&nbsp;pull&quot;&nbsp;to&nbsp;merge&nbsp;the&nbsp;remote&nbsp;branch&nbsp;into&nbsp;yours)</span></span></div></pre></div>\n<p>Now you have to push your changes to the remote repo. You have to use <code class=\"language-text\">--force</code>, since this is not a fast-forward commit and you have to rewrite the history of the remote repo.</p>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>git&nbsp;push&nbsp;origin&nbsp;master&nbsp;--force</span></span></div></pre></div>\n<p>Reference <a href=\"https://dalibornasevic.com/posts/2-permanently-remove-files-and-folders-from-a-git-repository\">here</a></p>\n<h2>Show branch name in Linux terminal</h2>\n<p>For this, you have to edit your <code class=\"language-text\">.bashrc</code> file. It should be in your <code class=\"language-text\">home</code> directory.</p>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>parse_git_branch()&nbsp;{</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;git&nbsp;branch&nbsp;2&gt;&nbsp;/dev/null&nbsp;|&nbsp;sed&nbsp;-e&nbsp;&#39;/^[^*]/d&#39;&nbsp;-e&nbsp;&#39;s/*&nbsp;\\(.*\\)/(\\1)/&#39;</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>}</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>if&nbsp;[&nbsp;&quot;$color_prompt&quot;&nbsp;=&nbsp;yes&nbsp;];&nbsp;then</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;PS1=&#39;${debian_chroot:+($debian_chroot)}\\[\\033[01;32m\\]\\u@\\h\\[\\033[00m\\]:\\[\\033[01;34m\\]\\w\\[\\033[01;31m\\]$(parse_git_branch)\\[\\033[00m\\]\\$&nbsp;&#39;</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>else</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;PS1=&#39;${debian_chroot:+($debian_chroot)}\\u@\\h:\\w$(parse_git_branch)\\$&nbsp;&#39;</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>fi</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>unset&nbsp;color_prompt&nbsp;force_color_prompt</span></span></div></pre></div>\n<p>Reference <a href=\"https://www.leaseweb.com/labs/2013/08/git-tip-show-your-branch-name-on-the-linux-prompt/\">here</a></p>\n<h2>Compare a file across 2 branches</h2>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>git&nbsp;difftool&nbsp;&lt;target&nbsp;branch&gt;&nbsp;--&nbsp;&lt;your&nbsp;file&gt;</span></span></div></pre></div>\n<p>For example, if you are on <code class=\"language-text\">master</code> and want to check a file on your <code class=\"language-text\">release-01.03.02</code> branch, run:</p>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>git&nbsp;difftool&nbsp;release-01.03.02&nbsp;--&nbsp;src/js/index.js</span></span></div></pre></div>\n<p>Reference <a href=\"https://stackoverflow.com/a/4099805/3036129\">here</a>, and if your file has a different name in 2 different branches, see <a href=\"https://stackoverflow.com/a/8131164/3036129\">here</a>.</p>\n<h2>List all commits for a specific file</h2>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>git&nbsp;log&nbsp;--follow&nbsp;filename</span></span></div></pre></div>\n<p>Reference <a href=\"https://stackoverflow.com/a/8808453/3036129\">here</a></p>\n<p>Configure Git aliases\nYou can use <code class=\"language-text\">git config</code> to create your aliases, but there is a faster way.\nAdd (or edit) the <code class=\"language-text\">alias</code> section of your <code class=\"language-text\">.gitconfig</code> file. It should be in your <code class=\"language-text\">home</code> directory.</p>\n<p>These is the <code class=\"language-text\">alias</code> section in my <code class=\"language-text\">.gitconfig</code>.</p>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>[alias]</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;st&nbsp;=&nbsp;status</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;au&nbsp;=&nbsp;add&nbsp;-u</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;dt&nbsp;=&nbsp;difftool</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;cm&nbsp;=&nbsp;commit&nbsp;-m</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;cma&nbsp;=&nbsp;commit&nbsp;--amend&nbsp;&nbsp;--no-edit</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;co&nbsp;=&nbsp;checkout</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;list&nbsp;aliases&nbsp;</span><span class=\"syntax--markup syntax--underline syntax--link syntax--https syntax--hyperlink\"><span>https://gist.github.com/mwhite/6887990</span></span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;la&nbsp;=&nbsp;&quot;!git&nbsp;config&nbsp;-l&nbsp;|&nbsp;grep&nbsp;alias&nbsp;|&nbsp;cut&nbsp;-c&nbsp;7-&quot;</span></span></div></pre></div>\n<p>For some other Git aliases, see <a href=\"https://git.wiki.kernel.org/index.php/Aliases\">this wiki</a>.</p>\n<p>Reference <a href=\"https://gist.github.com/mwhite/6887990\">here</a> and <a href=\"https://git-scm.com/book/it/v2/Git-Basics-Git-Aliases\">here</a></p>\n<h2>Commit only part of a file</h2>\n<p>You can use <code class=\"language-text\">git gui</code> for this. If you don’t have it already, install it with <code class=\"language-text\">sudo apt-get install git-gui</code>. Here is what I usually do:</p>\n<ol>\n<li><code class=\"language-text\">git gui</code></li>\n<li>right click on the code you want to commit and select <code class=\"language-text\">stage lines for commit</code> (or <code class=\"language-text\">stage hunk for commit</code>)</li>\n<li><code class=\"language-text\">git stash</code>, to save in the stash all changes that I am not committing right now</li>\n<li><code class=\"language-text\">git commit</code></li>\n<li><code class=\"language-text\">git stash apply</code></li>\n<li><code class=\"language-text\">git stash drop</code></li>\n</ol>\n<p>If you like (I personally don’t), you can replace</p>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>git&nbsp;stash&nbsp;apply</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>git&nbsp;stash&nbsp;drop</span></span></div></pre></div>\n<p>with</p>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>git&nbsp;stash&nbsp;pop</span></span></div></pre></div>\n<p>Reference <a href=\"http://stackoverflow.com/a/16137932\">here</a>.</p>\n<p>In alternative to <code class=\"language-text\">git gui</code>, you can use <a href=\"https://git-scm.com/book/en/v2/Git-Tools-Interactive-Staging\">interactive staging from the terminal</a>. I have never tried this.</p>\n<h2>Git hooks</h2>\n<p>I am not an expert on hooks in Git, but I found this really <a href=\"http://blog.ittybittyapps.com/blog/2013/09/03/git-pre-push/\">nice article about them</a>.</p>\n<p>I think the most useful hooks are</p>\n<ul>\n<li>pre-push</li>\n<li>prepare-commit-msg</li>\n<li>post-commit</li>\n</ul>\n<p>It would be nice to have a pre-merge hook, so we could prevent a feature branch from merging into master if certain conditions are not met (e.g. your tests fail). Since a pre-merge hook is not available, you’ll have to [write it]((<a href=\"https://stackoverflow.com/questions/19102714/how-would-i-write-a-pre-merge-hook-in-git\">https://stackoverflow.com/questions/19102714/how-would-i-write-a-pre-merge-hook-in-git</a>).</p>\n<p>Reference <a href=\"https://www.atlassian.com/git/tutorials/git-hooks\">here</a>.</p>\n<h2>Discard changes to Git submodules</h2>\n<p>I think it happened only once to me, but I had to reset all submodules with this line:</p>\n<div class='monokai'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>git&nbsp;submodule&nbsp;foreach&nbsp;git&nbsp;reset&nbsp;--hard</span></span></div></pre></div>\n<p>Reference <a href=\"https://kalyanchakravarthy.net/blog/git-discard-submodule-changes/\">here</a>.</p>","frontmatter":{"title":"My personal Git Memo","date":"July 20, 2017"}}},"pageContext":{"slug":"/2017-07-20-my-personal-git-memo/","previous":{"fields":{"slug":"/2017-05-12-getting-started-with-webpack-and-es6/"},"frontmatter":{"title":"Getting started with Webpack and ES6"}},"next":{"fields":{"slug":"/2017-07-28-pipenv/"},"frontmatter":{"title":"Pipenv"}}}}