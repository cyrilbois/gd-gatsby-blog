{"data":{"site":{"siteMetadata":{"title":"Giacomo Debidda","author":"Giacomo Debidda"}},"markdownRemark":{"id":"f43a9602-a056-598b-8c4f-4542efab7163 >>> MarkdownRemark","excerpt":"I have recently switched from D3 v3.0 to D3 v4.0, and I have already encountered some important changes. For example, the scaling functions…","html":"<p>I have recently switched from D3 v3.0 to D3 v4.0, and I have already encountered some important changes. For example, the scaling functions are quite different, and the <a href=\"https://github.com/d3/d3-3.x-api-reference/blob/master/Layouts.md\">old layouts available in the older API</a> have been moved and renamed. In fact, D3 v4.0 is no longer a single library, but many small libraries (about 30) that are designed to work together.</p>\n<p>For a weekend project I wanted to create a visualization of a simple graph with nodes and edges. In D3 v3.0 this can be done with <code class=\"language-text\">d3.layout.force</code>. In D3 v4.0 this is a job for <code class=\"language-text\">d3.forceSimulation</code>.</p>\n<h2>Looking for some data</h2>\n<p>I started looking for JSON files that contained the necessary information to represent a small social network graph. To my surprise, I didn’t find any. Instead, I found some small network data sets as GML files <a href=\"https://networkdata.ics.uci.edu/index.php\">here</a> and <a href=\"http://www-personal.umich.edu/~mejn/netdata/\">here</a>. I had never heard of the GML file format before, but since I liked these data sets I decided to proceed. At the end of the article you can see a visualization of a small social network of dolphins (62 nodes, 159 edges). The original file (<code class=\"language-text\">dolphins.gml</code>) was found on <a href=\"https://networkdata.ics.uci.edu/data.php?id=6\">this page</a> of the University of California Irvine.</p>\n<h2>GML (Graph Modelling Language)</h2>\n<p>The <a href=\"https://networkx.github.io/documentation/networkx-1.10/reference/readwrite.gml.html\">Graph Modelling Language</a>, not to be confused with the <a href=\"https://en.wikipedia.org/wiki/Geography_Markup_Language\">Geography Markup Language</a>, is a portable file format for graphs.</p>\n<p>A GML file looks like this:</p>\n<div class='aaaaaaa'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>#&nbsp;dolphins.gml</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>Creator&nbsp;&quot;Mark&nbsp;Newman&nbsp;on&nbsp;Wed&nbsp;Jul&nbsp;26&nbsp;15:04:20&nbsp;2006&quot;</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>graph</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>[</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;directed&nbsp;0</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;node</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;[</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;0</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;label&nbsp;&quot;Beak&quot;</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;]</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;node</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;[</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;1</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;label&nbsp;&quot;Beescratch&quot;</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;]</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;#&nbsp;more&nbsp;nodes&nbsp;here...</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;edge</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;[</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;source&nbsp;8</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;target&nbsp;3</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;]</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;edge</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;[</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;source&nbsp;9</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;&nbsp;&nbsp;target&nbsp;5</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;]</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>&nbsp;&nbsp;#&nbsp;more&nbsp;edges&nbsp;here...</span></span></div><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>]</span></span></div></pre></div>\n<p>It doesn’t look to different from a JSON file, but the problem is that D3 cannot load it directly. After a brief Google search I found out that I could use a Python library to load the GML file and convert it into JSON.</p>\n<h2>NetworkX</h2>\n<p><a href=\"http://networkx.readthedocs.io/en/networkx-1.11/index.html\">NetworkX</a> is a Python package for the creation, manipulation, and study of the structure, dynamics, and functions of complex networks. It’s distributed with a BSD license and was developed by Aric Hagberg, Dan Schulz and Pieter Swart.</p>\n<p>In NetworkX one can create graphs for undirected and directed networks, add and remove nodes and edges in different ways, visualize the network and export network data to draw it with an external tool.</p>\n<p>In order to visualize the network data you can use the <code class=\"language-text\">networkx.draw</code> function and save the image as a PNG with <code class=\"language-text\">matplotlib</code>.</p>\n<div class='aaaaaaa'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--source syntax--python\"><span class=\"syntax--keyword syntax--control syntax--import syntax--python\"><span>import</span></span><span>&nbsp;</span><span>networkx</span><span>&nbsp;</span><span class=\"syntax--keyword syntax--other syntax--python\"><span>as</span></span><span>&nbsp;</span><span>nx</span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span class=\"syntax--keyword syntax--control syntax--import syntax--python\"><span>import</span></span><span>&nbsp;</span><span>matplotlib</span><span>.</span><span>pylab</span><span>&nbsp;</span><span class=\"syntax--keyword syntax--other syntax--python\"><span>as</span></span><span>&nbsp;</span><span>plt</span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span>g</span><span>&nbsp;</span><span class=\"syntax--keyword syntax--operator syntax--assignment syntax--python\"><span>=</span></span><span>&nbsp;</span><span class=\"syntax--meta syntax--function-call syntax--python\"><span>nx</span><span>.</span><span>read_gml</span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python\"><span>(</span></span><span class=\"syntax--meta syntax--function-call syntax--arguments syntax--python\"><span class=\"syntax--string syntax--quoted syntax--single syntax--single-line syntax--python\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--python\"><span>&#39;</span></span><span>dolphins.gml</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--python\"><span>&#39;</span></span></span></span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python\"><span>)</span></span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span class=\"syntax--meta syntax--function-call syntax--python\"><span>nx</span><span>.</span><span>draw</span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python\"><span>(</span></span><span class=\"syntax--meta syntax--function-call syntax--arguments syntax--python\"><span>g</span></span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python\"><span>)</span></span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span class=\"syntax--meta syntax--function-call syntax--python\"><span>plt</span><span>.</span><span>savefig</span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python\"><span>(</span></span><span class=\"syntax--meta syntax--function-call syntax--arguments syntax--python\"><span class=\"syntax--string syntax--quoted syntax--single syntax--single-line syntax--python\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--python\"><span>&#39;</span></span><span>dolphins.png</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--python\"><span>&#39;</span></span></span></span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python\"><span>)</span></span></span></span></div></pre></div>\n<p>Apparently there must be some randomness when the figure gets generated, because I ran the code twice and I got 2 different PNG images.</p>\n<p>Here is the first one:</p>\n<p><img src=\"./dolphins_1.png\" alt=\"The figure generated when dolphins.gml is drawn, the first time\" title=\"The figure generated when dolphins.gml is drawn, the first time\"></p>\n<p>and the second one:</p>\n<p><img src=\"./dolphins_2.png\" alt=\"The figure generated when dolphins.gml is drawn, the second time\" title=\"The figure generated when dolphins.gml is drawn, the second time\"></p>\n<p>The network data can also be exported and visualized in a program like GraphViz or Gephi, or, like I will do here, in D3.</p>\n<p>I didn’t play with NetworkX too much, but from what I’ve seen <a href=\"http://networkx.readthedocs.io/en/networkx-1.11/tutorial/\">the documentation is great</a>. There is also a nice presentation <a href=\"https://www.cl.cam.ac.uk/~cm542/teaching/2010/stna-pdfs/stna-lecture8.pdf\">here</a>.</p>\n<p>Here is the snippet of code to convert a GML file into a JSON file:</p>\n<div class='aaaaaaa'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--source syntax--python\"><span class=\"syntax--keyword syntax--control syntax--import syntax--python\"><span>import</span></span><span>&nbsp;</span><span>networkx</span><span>&nbsp;</span><span class=\"syntax--keyword syntax--other syntax--python\"><span>as</span></span><span>&nbsp;</span><span>nx</span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span class=\"syntax--keyword syntax--control syntax--import syntax--python\"><span>import</span></span><span>&nbsp;</span><span>simplejson</span><span>&nbsp;</span><span class=\"syntax--keyword syntax--other syntax--python\"><span>as</span></span><span>&nbsp;</span><span>json</span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span class=\"syntax--keyword syntax--control syntax--import syntax--from syntax--python\"><span>from</span></span><span>&nbsp;</span><span>networkx</span><span>.</span><span>readwrite</span><span>&nbsp;</span><span class=\"syntax--keyword syntax--control syntax--import syntax--python\"><span>import</span></span><span>&nbsp;</span><span>json_graph</span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--python\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--python\"><span>#</span></span><span>&nbsp;parse&nbsp;the&nbsp;gml&nbsp;file&nbsp;and&nbsp;build&nbsp;the&nbsp;graph&nbsp;object</span><span>&nbsp;</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span>g</span><span>&nbsp;</span><span class=\"syntax--keyword syntax--operator syntax--assignment syntax--python\"><span>=</span></span><span>&nbsp;</span><span class=\"syntax--meta syntax--function-call syntax--python\"><span>nx</span><span>.</span><span>read_gml</span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python\"><span>(</span></span><span class=\"syntax--meta syntax--function-call syntax--arguments syntax--python\"><span class=\"syntax--string syntax--quoted syntax--single syntax--single-line syntax--python\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--python\"><span>&#39;</span></span><span>dolphins.gml</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--python\"><span>&#39;</span></span></span></span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python\"><span>)</span></span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--python\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--python\"><span>#</span></span><span>&nbsp;create&nbsp;a&nbsp;dictionary&nbsp;in&nbsp;a&nbsp;node-link&nbsp;format&nbsp;that&nbsp;is&nbsp;suitable&nbsp;for&nbsp;JSON&nbsp;serialization</span><span>&nbsp;</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span>d</span><span>&nbsp;</span><span class=\"syntax--keyword syntax--operator syntax--assignment syntax--python\"><span>=</span></span><span>&nbsp;</span><span class=\"syntax--meta syntax--function-call syntax--python\"><span>json_graph</span><span>.</span><span>node_link_data</span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python\"><span>(</span></span><span class=\"syntax--meta syntax--function-call syntax--arguments syntax--python\"><span>g</span></span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python\"><span>)</span></span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span class=\"syntax--keyword syntax--control syntax--statement syntax--python\"><span>with</span></span><span>&nbsp;</span><span class=\"syntax--meta syntax--function-call syntax--python\"><span class=\"syntax--support syntax--function syntax--builtin syntax--python\"><span>open</span></span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python\"><span>(</span></span><span class=\"syntax--meta syntax--function-call syntax--arguments syntax--python\"><span class=\"syntax--string syntax--quoted syntax--single syntax--single-line syntax--python\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--python\"><span>&#39;</span></span><span>dolphins.json</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--python\"><span>&#39;</span></span></span><span>,&nbsp;</span><span class=\"syntax--string syntax--quoted syntax--single syntax--single-line syntax--python\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--python\"><span>&#39;</span></span><span>w</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--python\"><span>&#39;</span></span></span></span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python\"><span>)</span></span></span><span>&nbsp;</span><span class=\"syntax--keyword syntax--other syntax--python\"><span>as</span></span><span>&nbsp;</span><span>fp</span><span>:</span></span></div><div class=\"line\"><span class=\"syntax--source syntax--python\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"syntax--meta syntax--function-call syntax--python\"><span>json</span><span>.</span><span>dump</span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python\"><span>(</span></span><span class=\"syntax--meta syntax--function-call syntax--arguments syntax--python\"><span>d</span><span>,&nbsp;</span><span>fp</span></span><span class=\"syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python\"><span>)</span></span></span></span></div></pre></div>\n<p>Note that the GML file I used with the latest NetworkX version (1.11) caused the Exception <code class=\"language-text\">networkx.exception.NetworkXError: cannot tokenize u&#39;graph&#39; at (2, 1)</code>. I downgraded NetworkX to version 1.9.1 as suggestes in <a href=\"https://www.bountysource.com/issues/27097685-problem-reading-gml-file\">this thread</a> and it worked fine. Another approach would have been to <a href=\"http://stackoverflow.com/questions/32895291/unexpected-error-reading-gml-graph/37819717#37819717\">format the GML file in a different way</a>.</p>\n<h2>The D3 visualization</h2>\n<p>Finally, with the network data available as <code class=\"language-text\">dolphins.json</code>, we can use <code class=\"language-text\">d3.json</code> to read it. Drag a node or hover on it to know the name of the dolphins in this network!</p>\n<figure class=\"dolphins-graph\"></figure>\n<h2>References</h2>\n<p>The file <code class=\"language-text\">dolphins.gml</code> contains an undirected social network of frequent associations between 62 dolphins in a community living off Doubtful Sound,\nNew Zealand, as compiled by Lusseau et al. (2003).</p>\n<p><em>D. Lusseau, K. Schneider, O. J. Boisseau, P. Haase, E. Slooten, and S. M. Dawson, The bottlenose dolphin community of Doubtful Sound features a large proportion of long-lasting associations, Behavioral Ecology and Sociobiology 54, 396-405 (2003).</em></p>\n<p>Additional information on the network can be found in:</p>\n<ul>\n<li>\n<p><em>D. Lusseau, The emergent properties of a dolphin social network, Proc. R. Soc. London B (suppl.) 270, S186-S188 (2003).</em></p>\n</li>\n<li>\n<p><em>D. Lusseau, <a href=\"http://arxiv.org/abs/q-bio.PE/0607048\">Evidence for social role in a dolphin social network</a>, Preprint q-bio/0607048</em></p>\n</li>\n</ul>","frontmatter":{"title":"Visualize GML files with D3","date":"January 12, 2017"}}},"pageContext":{"slug":"/2017-01-06-visualize-gml-files-with-d3/","previous":{"fields":{"slug":"/2016-12-29-interesting-things-other-people-did-in-2016/"},"frontmatter":{"title":"Interesting things other people did in 2016"}},"next":{"fields":{"slug":"/2017-01-21-bridge-pattern-in-python/"},"frontmatter":{"title":"Bridge pattern in Python"}}}}